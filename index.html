<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperEnalotto Analyzer PRO - Dynamic</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f5d4;
            --secondary: #7b2cbf;
            --accent: #f72585;
            --gold: #ffd60a;
            --dark-1: #0a0a0f;
            --dark-2: #12121a;
            --dark-3: #1a1a2e;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --glow-cyan: 0 0 30px rgba(0, 245, 212, 0.5);
            --glow-purple: 0 0 30px rgba(123, 44, 191, 0.5);
            --glow-pink: 0 0 30px rgba(247, 37, 133, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--dark-1);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            background-image:
                radial-gradient(ellipse at top left, rgba(123, 44, 191, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(0, 245, 212, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at center, rgba(247, 37, 133, 0.05) 0%, transparent 70%);
            background-attachment: fixed;
        }

        /* === CONTAINER PRINCIPALE === */
        .terminal {
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(145deg, var(--dark-2), var(--dark-1));
            border-radius: 24px;
            padding: 30px;
            border: 1px solid var(--glass-border);
            box-shadow:
                0 25px 50px -12px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .terminal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }

        /* === TITOLO === */
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 4px;
            position: relative;
            padding-bottom: 20px;
            text-shadow: 0 0 30px var(--primary);
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), var(--accent), transparent);
        }

        .recent-indicator {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, var(--accent), #ff006e);
            color: white;
            border-radius: 20px;
            font-size: 0.6rem;
            font-family: 'Rajdhani', sans-serif;
            margin-left: 10px;
            animation: pulse-glow 2s infinite;
            box-shadow: var(--glow-pink);
            vertical-align: middle;
        }

        @keyframes pulse-glow {
            0%, 100% { opacity: 1; box-shadow: 0 0 20px rgba(247, 37, 133, 0.5); }
            50% { opacity: 0.8; box-shadow: 0 0 40px rgba(247, 37, 133, 0.8); }
        }

        /* === PANNELLI GLASS === */
        .update-panel, .config-panel {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .update-panel {
            border-left: 3px solid var(--accent);
        }

        .update-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(247, 37, 133, 0.1), transparent);
            pointer-events: none;
        }

        .update-panel strong {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent);
        }

        .update-form {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            margin-top: 15px;
        }

        .update-form input {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--primary);
            padding: 12px 16px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .update-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 245, 212, 0.2);
        }

        .update-form input::placeholder {
            color: var(--text-secondary);
        }

        /* === PULSANTI 3D === */
        button {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: linear-gradient(145deg, var(--dark-3), var(--dark-2));
            color: var(--primary);
            border: 1px solid var(--glass-border);
            box-shadow:
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow:
                0 8px 25px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(0, 245, 212, 0.2);
            border-color: var(--primary);
        }

        button:hover::before {
            left: 100%;
        }

        button:active {
            transform: translateY(-1px);
        }

        .update-form button {
            background: linear-gradient(135deg, var(--accent), #ff006e);
            color: white;
            border: none;
            box-shadow: 0 4px 20px rgba(247, 37, 133, 0.4);
        }

        .update-form button:hover {
            box-shadow: 0 6px 30px rgba(247, 37, 133, 0.6);
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .controls button {
            flex: 1;
            min-width: 160px;
        }

        /* === TEXTAREA === */
        textarea {
            width: 100%;
            height: 150px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--primary);
            padding: 16px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.95rem;
            margin-bottom: 20px;
            resize: vertical;
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 30px rgba(0, 245, 212, 0.15);
        }

        /* === SLIDER MODERNI === */
        .slider-group {
            margin: 20px 0;
        }

        .slider-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--dark-1), var(--dark-3));
            border-radius: 10px;
            outline: none;
            margin: 10px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(145deg, var(--primary), #00c4a7);
            border-radius: 50%;
            cursor: pointer;
            box-shadow:
                0 0 20px rgba(0, 245, 212, 0.5),
                0 4px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 30px rgba(0, 245, 212, 0.8);
        }

        .recent-weight-group {
            background: linear-gradient(135deg, rgba(247, 37, 133, 0.2), rgba(255, 0, 110, 0.1));
            border: 1px solid rgba(247, 37, 133, 0.3);
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
        }

        .recent-weight-group input[type="range"]::-webkit-slider-thumb {
            background: linear-gradient(145deg, var(--accent), #ff006e);
            box-shadow: 0 0 20px rgba(247, 37, 133, 0.5);
        }

        /* === STRATEGIE === */
        .strategies-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }

        .strategy-btn {
            padding: 16px 12px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-secondary);
            cursor: pointer;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .strategy-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .strategy-btn:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: var(--primary);
            box-shadow: 0 10px 40px rgba(0, 245, 212, 0.2);
        }

        .strategy-btn:hover::before {
            opacity: 1;
        }

        .strategy-btn.active {
            background: linear-gradient(135deg, rgba(0, 245, 212, 0.15), rgba(123, 44, 191, 0.1));
            border-color: var(--primary);
            color: var(--primary);
            box-shadow:
                0 0 30px rgba(0, 245, 212, 0.2),
                inset 0 0 30px rgba(0, 245, 212, 0.05);
            transform: translateY(-3px);
        }

        .strategy-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* === RISULTATI === */
        .results {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            display: none;
            margin-top: 25px;
        }

        .strategy-section {
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(145deg, var(--dark-2), var(--dark-1));
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .strategy-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            border-radius: 4px 0 0 4px;
        }

        .strategy-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .strategy-section.updated {
            animation: card-highlight 1s ease;
        }

        @keyframes card-highlight {
            0%, 100% { box-shadow: 0 0 0 rgba(247, 37, 133, 0); }
            50% { box-shadow: 0 0 50px rgba(247, 37, 133, 0.3); }
        }

        .strategy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .strategy-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            text-shadow: 0 0 20px currentColor;
        }

        /* === PALLINE 3D === */
        .balls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
            perspective: 1000px;
        }

        .ball {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            position: relative;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);

            /* Effetto 3D sferico */
            background: radial-gradient(circle at 30% 30%,
                rgba(255, 255, 255, 0.4) 0%,
                #3b82f6 25%,
                #1d4ed8 70%,
                #1e3a8a 100%);
            box-shadow:
                inset -8px -8px 20px rgba(0, 0, 0, 0.4),
                inset 5px 5px 15px rgba(255, 255, 255, 0.2),
                0 10px 30px rgba(59, 130, 246, 0.4),
                0 5px 15px rgba(0, 0, 0, 0.3);
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transform-style: preserve-3d;
        }

        .ball::before {
            content: '';
            position: absolute;
            top: 8%;
            left: 15%;
            width: 35%;
            height: 25%;
            background: linear-gradient(180deg,
                rgba(255, 255, 255, 0.8) 0%,
                rgba(255, 255, 255, 0) 100%);
            border-radius: 50%;
            filter: blur(2px);
        }

        .ball:hover {
            transform: translateY(-10px) rotateX(15deg) rotateY(-15deg) scale(1.1);
            box-shadow:
                inset -8px -8px 20px rgba(0, 0, 0, 0.4),
                inset 5px 5px 15px rgba(255, 255, 255, 0.2),
                0 20px 50px rgba(59, 130, 246, 0.6),
                0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .ball.new {
            animation: ball-entrance 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes ball-entrance {
            0% {
                transform: scale(0) rotateY(180deg);
                opacity: 0;
            }
            60% {
                transform: scale(1.2) rotateY(-20deg);
            }
            100% {
                transform: scale(1) rotateY(0);
                opacity: 1;
            }
        }

        .ball.star {
            background: radial-gradient(circle at 30% 30%,
                rgba(255, 255, 255, 0.6) 0%,
                #ffd60a 20%,
                #ffc300 50%,
                #e6ac00 80%,
                #b38600 100%);
            box-shadow:
                inset -8px -8px 20px rgba(0, 0, 0, 0.3),
                inset 5px 5px 15px rgba(255, 255, 255, 0.4),
                0 10px 30px rgba(255, 214, 10, 0.5),
                0 5px 15px rgba(0, 0, 0, 0.3);
            color: #1a1a2e;
        }

        .ball.system {
            width: 55px;
            height: 55px;
            background: radial-gradient(circle at 30% 30%,
                rgba(255, 255, 255, 0.5) 0%,
                #fbbf24 20%,
                #f59e0b 60%,
                #d97706 100%);
            box-shadow:
                inset -6px -6px 15px rgba(0, 0, 0, 0.3),
                inset 4px 4px 10px rgba(255, 255, 255, 0.3),
                0 8px 25px rgba(251, 191, 36, 0.4);
            color: var(--dark-1);
            font-size: 1rem;
        }

        .recency-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, var(--accent), #ff006e);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 0.65rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            box-shadow: 0 0 15px var(--accent);
            animation: badge-pulse 1.5s infinite;
            z-index: 10;
        }

        @keyframes badge-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        /* === COMBINAZIONI === */
        .combination-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin: 12px 0;
            padding: 15px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .combination-row:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .combination-row .ball {
            width: 42px;
            height: 42px;
            font-size: 0.9rem;
        }

        .combination-label {
            min-width: 90px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* === SYSTEM SUMMARY === */
        .system-summary {
            background: linear-gradient(145deg, var(--dark-2), var(--dark-1));
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
            border: 2px solid var(--gold);
            box-shadow: 0 0 40px rgba(255, 214, 10, 0.15);
            position: relative;
            overflow: hidden;
        }

        .system-summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 214, 10, 0.05), transparent);
            pointer-events: none;
        }

        .system-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .system-stat {
            background: var(--glass);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .system-stat::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            border-radius: 4px 0 0 4px;
        }

        .system-stat:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 245, 212, 0.15);
        }

        .system-stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .system-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .guarantee-badge {
            display: inline-block;
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--primary), #00c4a7);
            color: var(--dark-1);
            border-radius: 25px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            margin: 0 5px;
            box-shadow: 0 4px 20px rgba(0, 245, 212, 0.4);
        }

        /* === INFO BOX === */
        .info-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(123, 44, 191, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
        }

        .info-box h4 {
            font-family: 'Orbitron', sans-serif;
            color: #60a5fa;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .info-box p {
            color: var(--text-secondary);
            line-height: 1.8;
        }

        /* === SUPER SYSTEM === */
        .super-system-card {
            background: linear-gradient(145deg, #1e1b4b, #312e81);
            border: 2px solid var(--secondary);
            border-radius: 24px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 0 0 50px rgba(123, 44, 191, 0.25);
            position: relative;
            overflow: hidden;
        }

        .super-system-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(168, 85, 247, 0.1), transparent);
            animation: rotate-bg 10s linear infinite;
        }

        @keyframes rotate-bg {
            100% { transform: rotate(360deg); }
        }

        .mega-stat {
            text-align: center;
            padding: 35px;
            background: linear-gradient(145deg, var(--secondary), #9333ea);
            border-radius: 20px;
            margin: 30px 0;
            box-shadow:
                0 20px 50px rgba(123, 44, 191, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .mega-stat::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.1), transparent);
            pointer-events: none;
        }

        .mega-stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 4rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 40px rgba(255, 255, 255, 0.5);
        }

        .mega-stat-label {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: #e9d5ff;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        /* === TABELLE === */
        .comparison-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 25px 0;
            background: var(--dark-2);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .comparison-table th {
            background: linear-gradient(135deg, var(--secondary), #9333ea);
            color: white;
            padding: 18px 20px;
            text-align: left;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .comparison-table td {
            padding: 15px 20px;
            border-bottom: 1px solid var(--glass-border);
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .comparison-table tr:hover td {
            background: var(--glass);
            color: var(--text-primary);
        }

        .comparison-table tr:last-child td {
            border-bottom: none;
        }

        /* === POOLS === */
        .strategy-pool {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .strategy-pool-card {
            background: var(--glass);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .strategy-pool-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
        }

        .strategy-pool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        /* === WARNING / VALIDATION === */
        .warning-box {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.15), rgba(127, 29, 29, 0.1));
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-left: 4px solid #dc2626;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
        }

        .warning-box h4 {
            font-family: 'Orbitron', sans-serif;
            color: #fca5a5;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .warning-box p {
            color: #fecaca;
            line-height: 1.8;
        }

        .validation-info {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(6, 95, 70, 0.1));
            color: #d1fae5;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 12px;
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-left: 4px solid #10b981;
            font-weight: 500;
        }

        .validation-error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(127, 29, 29, 0.1));
            color: #fecaca;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 12px;
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-left: 4px solid #ef4444;
        }

        .comparison {
            margin-top: 20px;
            padding: 15px;
            background: var(--glass);
            border-radius: 12px;
            font-size: 0.85rem;
            border: 1px solid var(--glass-border);
        }

        .comparison .added { color: var(--primary); }
        .comparison .removed { color: var(--accent); }

        /* === LOADING === */
        #loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--glass-border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
            box-shadow: 0 0 20px rgba(0, 245, 212, 0.3);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .winner-badge {
            display: inline-block;
            padding: 6px 16px;
            background: linear-gradient(135deg, var(--primary), #00c4a7);
            color: var(--dark-1);
            border-radius: 20px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .label {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin: 20px 0 12px 0;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 500;
        }

        /* === SCROLLBAR CUSTOM === */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #00c4a7, #9333ea);
        }

        /* === ULTIMA ESTRAZIONE === */
        .last-extraction-panel {
            background: linear-gradient(145deg, var(--dark-2), var(--dark-1));
            border: 2px solid var(--primary);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            box-shadow:
                0 0 40px rgba(0, 245, 212, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .last-extraction-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }

        .last-extraction-panel::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(0, 245, 212, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }

        .last-extraction-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .last-extraction-icon {
            font-size: 2rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .last-extraction-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            text-shadow: 0 0 20px var(--primary);
            letter-spacing: 2px;
        }

        .last-extraction-date {
            margin-left: auto;
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.85rem;
            color: var(--text-secondary);
            background: var(--glass);
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .last-extraction-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .last-extraction-main {
            text-align: center;
        }

        .last-extraction-star {
            text-align: center;
            position: relative;
        }

        .last-extraction-star::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 80%;
            background: linear-gradient(180deg, transparent, var(--glass-border), transparent);
        }

        .extraction-label {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            color: var(--text-secondary);
            letter-spacing: 2px;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .last-extraction-balls {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .last-extraction-balls .ball {
            width: 65px;
            height: 65px;
            font-size: 1.3rem;
            animation: float 3s ease-in-out infinite;
        }

        .last-extraction-balls .ball:nth-child(1) { animation-delay: 0s; }
        .last-extraction-balls .ball:nth-child(2) { animation-delay: 0.2s; }
        .last-extraction-balls .ball:nth-child(3) { animation-delay: 0.4s; }
        .last-extraction-balls .ball:nth-child(4) { animation-delay: 0.6s; }
        .last-extraction-balls .ball:nth-child(5) { animation-delay: 0.8s; }
        .last-extraction-balls .ball:nth-child(6) { animation-delay: 1s; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .last-extraction-star-ball .ball {
            width: 75px;
            height: 75px;
            font-size: 1.5rem;
            animation: star-glow 2s ease-in-out infinite;
        }

        @keyframes star-glow {
            0%, 100% {
                box-shadow:
                    inset -8px -8px 20px rgba(0, 0, 0, 0.3),
                    inset 5px 5px 15px rgba(255, 255, 255, 0.4),
                    0 10px 30px rgba(255, 214, 10, 0.5),
                    0 0 60px rgba(255, 214, 10, 0.3);
            }
            50% {
                box-shadow:
                    inset -8px -8px 20px rgba(0, 0, 0, 0.3),
                    inset 5px 5px 15px rgba(255, 255, 255, 0.4),
                    0 10px 30px rgba(255, 214, 10, 0.8),
                    0 0 80px rgba(255, 214, 10, 0.5);
            }
        }

        .last-extraction-star-ball .no-star {
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.9rem;
            color: var(--text-secondary);
            padding: 20px;
            background: var(--glass);
            border-radius: 12px;
            border: 1px dashed var(--glass-border);
        }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .terminal {
                padding: 15px;
                border-radius: 16px;
            }

            h1 {
                font-size: 1.2rem;
                letter-spacing: 2px;
            }

            .ball {
                width: 50px;
                height: 50px;
                font-size: 1rem;
            }

            .controls {
                flex-direction: column;
            }

            .controls button {
                min-width: 100%;
            }

            .mega-stat-value {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
<div class="terminal">
    <h1>> ANALYZER_PRO_v5.0_DYNAMIC <span class="recent-indicator">ESTRAZIONI RECENTI</span></h1>

    <!-- ULTIMA ESTRAZIONE -->
    <div id="lastExtractionPanel" class="last-extraction-panel" style="display: none;">
        <div class="last-extraction-header">
            <span class="last-extraction-icon">üé±</span>
            <span class="last-extraction-title">ULTIMA ESTRAZIONE</span>
            <span id="lastExtractionDate" class="last-extraction-date"></span>
        </div>
        <div class="last-extraction-content">
            <div class="last-extraction-main">
                <div class="extraction-label">NUMERI VINCENTI</div>
                <div id="lastExtractionBalls" class="last-extraction-balls">
                    <!-- Palline inserite via JS -->
                </div>
            </div>
            <div class="last-extraction-star">
                <div class="extraction-label">SUPERSTAR</div>
                <div id="lastExtractionStar" class="last-extraction-star-ball">
                    <!-- SuperStar inserito via JS -->
                </div>
            </div>
        </div>
    </div>

    <div class="update-panel">
        <strong>üîÑ AGGIORNAMENTO LIVE</strong>
        <div style="font-size: 0.8rem; color: #94a3b8; margin-top: 5px;">
            Aggiungi l'ultima estrazione per vedere cambiamenti immediati
        </div>
        <div class="update-form">
            <input type="text" id="newExtraction" placeholder="Es: 5,12,23,45,67,89,10 (6 num + SS)" />
            <button onclick="addNewExtraction()">AGGIUNGI ESTRAZIONE</button>
        </div>
    </div>

    <div class="controls">
        <input type="file" id="fileInput" style="display:none" accept=".txt,.csv">
        <button onclick="document.getElementById('fileInput').click()">CARICA ARCHIVIO</button>
        <button onclick="analyzeAllStrategies()" style="color: #f8fafc; border-color: #34d399;">ANALISI COMPLETA</button>
        <button onclick="showSystemsGenerator()" style="color: #fbbf24; border-color: #fbbf24;">SISTEMI RIDOTTI</button>
        <button onclick="showSuperSystem()" style="color: #a855f7; border-color: #a855f7;">SUPER SISTEMA</button>
        <button onclick="showMegaSystem()" style="color: #f97316; border-color: #f97316;">MEGA SISTEMA</button>
        <button onclick="clearData()" style="color: #ef4444; border-color: #ef4444;">RESET</button>
    </div>

    <div class="config-panel">
        <div class="slider-group">
            <label>PESO FREQUENZA BASE: <span id="freqValue">50%</span></label>
            <input type="range" id="freqWeight" min="0" max="100" value="50">
        </div>
        <div class="slider-group">
            <label>PESO RITARDO BASE: <span id="delayValue">30%</span></label>
            <input type="range" id="delayWeight" min="0" max="100" value="30">
        </div>
        <div class="recent-weight-group">
            <label>PESO ESTRAZIONI RECENTI (ultime 10): <span id="recentValue">20%</span></label>
            <input type="range" id="recentWeight" min="0" max="100" value="20">
            <div style="font-size: 0.7rem; color: #fecaca;">
                Pi√π alto = maggiore influenza delle nuove estrazioni
            </div>
        </div>
    </div>

    <div class="strategies-panel">
        <div class="strategy-btn active" onclick="selectStrategy('balanced')">
            <div>‚öñÔ∏è BILANCIATA</div>
            <div class="strategy-desc">Equilibrio perfetto</div>
        </div>
        <div class="strategy-btn" onclick="selectStrategy('recentFocused')">
            <div>üéØ FOCUS RECENTI</div>
            <div class="strategy-desc">Ultime estrazioni</div>
        </div>
        <div class="strategy-btn" onclick="selectStrategy('hotNumbers')">
            <div>üî• NUMERI CALDI</div>
            <div class="strategy-desc">I pi√π frequenti</div>
        </div>
        <div class="strategy-btn" onclick="selectStrategy('coldNumbers')">
            <div>‚ùÑÔ∏è RITARDATARI</div>
            <div class="strategy-desc">Massimo ritardo</div>
        </div>
        <div class="strategy-btn" onclick="selectStrategy('contrarian')">
            <div>üîÑ CONTRARIAN</div>
            <div class="strategy-desc">Anti-popolare</div>
        </div>
        <div class="strategy-btn" onclick="selectStrategy('mathematical')">
            <div>üìê MATEMATICA</div>
            <div class="strategy-desc">Distribuzione uniforme</div>
        </div>
    </div>

    <textarea id="dataInput" placeholder="Archivio caricato apparir√† qui..."></textarea>

    <div id="validationInfo"></div>

    <div id="loading">
        <div class="spinner"></div>
        <div style="margin-top: 10px; color: #94a3b8;">ANALISI IN CORSO...</div>
    </div>

    <div id="results" class="results">
        <div id="updateInfo" style="margin-bottom: 20px;"></div>
        <div id="strategyResults"></div>
        <div id="log" style="font-size: 0.7rem; color: #475569; margin-top: 20px; text-align: left;"></div>
    </div>

    <div id="systemsPanel" class="results" style="display: none;">
        <h2 style="color: #fbbf24; margin-bottom: 20px; text-align: center;">
            üéØ GENERATORE SISTEMI RIDOTTI
        </h2>

        <div style="background: #1e293b; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #fbbf24;">
            <h3 style="color: #f8fafc; margin-bottom: 15px;">üìö Cosa sono i Sistemi Ridotti?</h3>
            <p style="color: #94a3b8; line-height: 1.8; margin-bottom: 15px;">
                Un <strong>Sistema Ridotto</strong> √® l'UNICO modo matematicamente valido di aumentare le tue chance.
                Invece di giocare 1 sestina, ne giochi multiple in modo intelligente.
            </p>
            <div style="background: #0f172a; padding: 15px; border-radius: 5px; border-left: 3px solid #10b981;">
                <strong style="color: #10b981;">‚úì GARANZIA MATEMATICA:</strong><br>
                <span style="color: #d1fae5;">
                Se tra i tuoi N numeri ci sono 6 numeri vincenti, hai la GARANZIA di fare almeno un certo premio (3, 4 o 5).
                </span>
            </div>
        </div>

        <div class="config-panel">
            <h3 style="color: #f8fafc; margin-bottom: 15px;">‚öôÔ∏è Configurazione Sistema</h3>

            <div class="slider-group">
                <label>NUMERI DA GIOCARE: <span id="systemNumbersValue">9</span></label>
                <input type="range" id="systemNumbers" min="7" max="15" value="9">
                <div style="font-size: 0.7rem; color: #94a3b8; margin-top: 5px;">
                    Pi√π numeri = pi√π combinazioni = costo maggiore ma garanzie migliori
                </div>
            </div>

            <div class="slider-group" style="margin-top: 20px;">
                <label>GARANZIA MINIMA:</label>
                <select id="systemGuarantee" style="width: 100%; padding: 8px; background: #020617; border: 1px solid #334155; color: #10b981; border-radius: 4px;">
                    <option value="3">Garanzia 3 (economico, molte combinazioni)</option>
                    <option value="4" selected>Garanzia 4 (bilanciato)</option>
                    <option value="5">Garanzia 5 (costoso, poche combinazioni)</option>
                </select>
                <div style="font-size: 0.7rem; color: #94a3b8; margin-top: 5px;">
                    Se indovini 6/6 tra i tuoi numeri, FAI ALMENO questo premio
                </div>
            </div>

            <div style="margin-top: 20px;">
                <label style="color: #94a3b8; margin-bottom: 10px; display: block;">FONTE NUMERI:</label>
                <select id="systemSource" style="width: 100%; padding: 8px; background: #020617; border: 1px solid #334155; color: #10b981; border-radius: 4px;">
                    <option value="balanced">Strategia Bilanciata</option>
                    <option value="hotNumbers">Numeri Caldi</option>
                    <option value="coldNumbers">Numeri Ritardatari</option>
                    <option value="mathematical">Distribuzione Matematica</option>
                    <option value="contrarian">Strategia Contrarian</option>
                    <option value="mixed">Mix Intelligente (consigliato)</option>
                </select>
            </div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button onclick="generateReducedSystem()" style="padding: 15px 40px; font-size: 1.1rem; background: #fbbf24; color: #020617; border: 2px solid #f59e0b;">
                üé≤ GENERA SISTEMA RIDOTTO
            </button>
        </div>

        <div id="systemResults"></div>
    </div>

    <div id="superSystemPanel" class="results" style="display: none;">
        <h2 style="color: #a855f7; margin-bottom: 20px; text-align: center; font-size: 2rem;">
            ‚ö° SUPER SISTEMA - COPERTURA MASSIMA
        </h2>

        <div style="background: linear-gradient(135deg, #581c87 0%, #7c3aed 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 3px solid #a855f7; box-shadow: 0 0 30px rgba(168, 85, 247, 0.3);">
            <h3 style="color: #fff; margin-bottom: 20px; text-align: center; font-size: 1.4rem;">
                üéØ IL SISTEMA PI√ô POTENTE
            </h3>
            <p style="color: #e9d5ff; line-height: 1.8; margin-bottom: 15px; font-size: 1.05rem;">
                Il <strong>SUPER SISTEMA</strong> combina MULTIPLE strategie in un unico mega-sistema.
                Invece di scegliere UNA strategia, le giochi TUTTE contemporaneamente con riduzione intelligente!
            </p>
            <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; border-left: 4px solid #10b981;">
                <strong style="color: #10b981; font-size: 1.1rem;">‚úì VANTAGGI:</strong><br>
                <span style="color: #d1fae5; line-height: 2;">
                ‚Ä¢ Copri TUTTE le filosofie (caldi, freddi, bilanciati, matematici)<br>
                ‚Ä¢ Riduzione automatica delle combinazioni duplicate<br>
                ‚Ä¢ Massimizza la diversificazione<br>
                ‚Ä¢ Se una strategia "azzecca", sei coperto!
                </span>
            </div>
        </div>

        <div class="config-panel" style="border: 2px solid #a855f7;">
            <h3 style="color: #a855f7; margin-bottom: 20px;">‚öôÔ∏è Configurazione Super Sistema</h3>

            <div class="slider-group">
                <label>BUDGET TOTALE: <span id="superBudgetValue">50‚Ç¨</span></label>
                <input type="range" id="superBudget" min="20" max="200" value="50" step="10">
                <div style="font-size: 0.75rem; color: #94a3b8; margin-top: 5px;">
                    Il sistema ottimizzer√† il numero di combinazioni in base al tuo budget
                </div>
            </div>

            <div style="margin-top: 25px; background: #0f172a; padding: 20px; border-radius: 10px;">
                <label style="color: #a855f7; display: block; margin-bottom: 15px; font-weight: bold;">
                    üé® STRATEGIE DA INCLUDERE (seleziona almeno 2):
                </label>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px; transition: all 0.3s;">
                        <input type="checkbox" id="includeCaldi" checked style="margin-right: 10px; width: 18px; height: 18px;">
                        üî• Numeri Caldi
                    </label>
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px;">
                        <input type="checkbox" id="includeFreddi" checked style="margin-right: 10px; width: 18px; height: 18px;">
                        ‚ùÑÔ∏è Ritardatari
                    </label>
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px;">
                        <input type="checkbox" id="includeBalanced" checked style="margin-right: 10px; width: 18px; height: 18px;">
                        ‚öñÔ∏è Bilanciata
                    </label>
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px;">
                        <input type="checkbox" id="includeRecent" checked style="margin-right: 10px; width: 18px; height: 18px;">
                        üéØ Focus Recenti
                    </label>
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px;">
                        <input type="checkbox" id="includeContrarian" style="margin-right: 10px; width: 18px; height: 18px;">
                        üîÑ Contrarian
                    </label>
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px;">
                        <input type="checkbox" id="includeMath" style="margin-right: 10px; width: 18px; height: 18px;">
                        üìê Matematica
                    </label>
                </div>
            </div>

            <div style="margin-top: 25px;">
                <label style="color: #a855f7; display: block; margin-bottom: 10px; font-weight: bold;">
                    üé≤ MODALIT√Ä SUPER SISTEMA:
                </label>
                <select id="superMode" style="width: 100%; padding: 12px; background: #020617; border: 2px solid #a855f7; color: #e9d5ff; border-radius: 8px; font-size: 1rem;">
                    <option value="union">üåü UNION (Unione) - Max copertura, nessun duplicato</option>
                    <option value="intersection">üéØ INTERSECTION (Intersezione) - Solo numeri comuni</option>
                    <option value="hybrid">‚ö° HYBRID (Ibrido) - Mix intelligente</option>
                    <option value="megasystem">üöÄ MEGASYSTEM - Tutte le combinazioni</option>
                </select>
                <div style="font-size: 0.75rem; color: #94a3b8; margin-top: 8px; line-height: 1.6;">
                    <strong>Union:</strong> Prende i migliori numeri da ogni strategia (pi√π diversificato)<br>
                    <strong>Intersection:</strong> Solo numeri che appaiono in pi√π strategie (pi√π concentrato)<br>
                    <strong>Hybrid:</strong> 50% union + 50% intersection (equilibrato)<br>
                    <strong>Megasystem:</strong> Gioca tutte le sestine delle strategie selezionate
                </div>
            </div>
        </div>

        <div style="text-align: center; margin: 35px 0;">
            <button onclick="generateSuperSystem()" style="padding: 20px 50px; font-size: 1.3rem; background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%); color: white; border: 3px solid #c084fc; border-radius: 15px; box-shadow: 0 0 20px rgba(168, 85, 247, 0.5); cursor: pointer; font-weight: bold; transition: all 0.3s;">
                ‚ö° GENERA SUPER SISTEMA ‚ö°
            </button>
        </div>

        <div id="superSystemResults"></div>
    </div>

    <!-- MEGA SISTEMA - 100 Sestine -->
    <div id="megaSystemPanel" class="results" style="display: none;">
        <h2 style="color: #f97316; margin-bottom: 20px; text-align: center; font-size: 2rem;">
            üöÄ MEGA SISTEMA - 100 SESTINE
        </h2>

        <div style="background: linear-gradient(135deg, #9a3412 0%, #ea580c 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 3px solid #f97316; box-shadow: 0 0 30px rgba(249, 115, 22, 0.3);">
            <h3 style="color: #fff; margin-bottom: 20px; text-align: center; font-size: 1.4rem;">
                üíé IL SISTEMA DEFINITIVO
            </h3>
            <p style="color: #fed7aa; line-height: 1.8; margin-bottom: 15px; font-size: 1.05rem;">
                Il <strong>MEGA SISTEMA</strong> genera esattamente <strong>100 sestine ottimizzate</strong> combinando tutte le strategie con algoritmi avanzati di diversificazione.
            </p>
            <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; border-left: 4px solid #10b981;">
                <strong style="color: #10b981; font-size: 1.1rem;">‚úì CARATTERISTICHE:</strong><br>
                <span style="color: #d1fae5; line-height: 2;">
                    ‚Ä¢ Esattamente 100 sestine generate<br>
                    ‚Ä¢ Mix di tutte le 6 strategie<br>
                    ‚Ä¢ Diversificazione garantita (somma, pari/dispari, zone)<br>
                    ‚Ä¢ Copertura ottimale del range 1-90<br>
                    ‚Ä¢ Nessun duplicato garantito
                </span>
            </div>
        </div>

        <div class="config-panel" style="border: 2px solid #f97316;">
            <h3 style="color: #f97316; margin-bottom: 20px;">‚öôÔ∏è Configurazione Mega Sistema</h3>

            <div style="margin-top: 25px; background: #0f172a; padding: 20px; border-radius: 10px;">
                <label style="color: #f97316; display: block; margin-bottom: 15px; font-weight: bold;">
                    üé® STRATEGIE DA INCLUDERE (tutte consigliate):
                </label>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px; transition: all 0.3s;">
                        <input type="checkbox" id="megaIncludeCaldi" checked style="margin-right: 10px; width: 18px; height: 18px;">
                        üî• Numeri Caldi
                    </label>
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px;">
                        <input type="checkbox" id="megaIncludeFreddi" checked style="margin-right: 10px; width: 18px; height: 18px;">
                        ‚ùÑÔ∏è Ritardatari
                    </label>
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px;">
                        <input type="checkbox" id="megaIncludeBalanced" checked style="margin-right: 10px; width: 18px; height: 18px;">
                        ‚öñÔ∏è Bilanciata
                    </label>
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px;">
                        <input type="checkbox" id="megaIncludeRecent" checked style="margin-right: 10px; width: 18px; height: 18px;">
                        üéØ Focus Recenti
                    </label>
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px;">
                        <input type="checkbox" id="megaIncludeContrarian" checked style="margin-right: 10px; width: 18px; height: 18px;">
                        üîÑ Contrarian
                    </label>
                    <label style="display: flex; align-items: center; color: #94a3b8; cursor: pointer; padding: 10px; background: #1e293b; border-radius: 5px;">
                        <input type="checkbox" id="megaIncludeMath" checked style="margin-right: 10px; width: 18px; height: 18px;">
                        üìê Matematica
                    </label>
                </div>
            </div>

            <div style="margin-top: 25px;">
                <label style="color: #f97316; display: block; margin-bottom: 10px; font-weight: bold;">
                    üé≤ CRITERIO DI DIVERSIFICAZIONE:
                </label>
                <select id="megaDiversification" style="width: 100%; padding: 12px; background: #020617; border: 2px solid #f97316; color: #fed7aa; border-radius: 8px; font-size: 1rem;">
                    <option value="balanced">‚öñÔ∏è BILANCIATO - Mix equilibrato di tutti i criteri</option>
                    <option value="sum">üìä SOMMA OTTIMALE - Privilegia sestine con somma 200-340</option>
                    <option value="coverage">üéØ COPERTURA MASSIMA - Massimizza i numeri diversi usati</option>
                    <option value="zones">üìç ZONE UNIFORMI - Distribuzione uniforme 1-90</option>
                </select>
                <div style="font-size: 0.75rem; color: #94a3b8; margin-top: 8px; line-height: 1.6;">
                    <strong>Bilanciato:</strong> Applica tutti i criteri in modo equilibrato<br>
                    <strong>Somma Ottimale:</strong> Statisticamente, le sestine vincenti hanno spesso somma tra 200-340<br>
                    <strong>Copertura Massima:</strong> Usa il maggior numero possibile di numeri diversi<br>
                    <strong>Zone Uniformi:</strong> Garantisce presenza di numeri da ogni zona (1-15, 16-30, ecc.)
                </div>
            </div>
        </div>

        <div style="text-align: center; margin: 35px 0;">
            <button onclick="generateMegaSystem()" style="padding: 20px 50px; font-size: 1.3rem; background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white; border: 3px solid #fb923c; border-radius: 15px; box-shadow: 0 0 20px rgba(249, 115, 22, 0.5); cursor: pointer; font-weight: bold; transition: all 0.3s;">
                üöÄ GENERA 100 SESTINE üöÄ
            </button>
        </div>

        <div id="megaSystemResults"></div>
    </div>
</div>

<script>
    // ===============================
    // VARIABILI GLOBALI
    // ===============================
    let currentStrategy = 'balanced';
    let analysisData = null;
    let previousResults = null;
    let recentExtractions = [];

    const strategies = {
        'balanced': {
            name: 'Bilanciata con Influenza Recente',
            desc: 'Equilibrio con maggior peso alle estrazioni recenti',
            freqWeight: 0.5,
            delayWeight: 0.3,
            recentWeight: 0.2,
            color: '#34d399'
        },
        'recentFocused': {
            name: 'Focus Estrazioni Recenti',
            desc: 'Massima enfasi sulle nuove estrazioni',
            freqWeight: 0.3,
            delayWeight: 0.2,
            recentWeight: 0.5,
            color: '#dc2626'
        },
        'hotNumbers': {
            name: 'Cacciatore di Numeri Caldi',
            desc: 'Solo i pi√π frequenti in assoluto',
            freqWeight: 0.9,
            delayWeight: 0.05,
            recentWeight: 0.05,
            color: '#f59e0b'
        },
        'coldNumbers': {
            name: 'Cacciatore di Ritardatari',
            desc: 'Solo i numeri con maggior ritardo',
            freqWeight: 0.1,
            delayWeight: 0.8,
            recentWeight: 0.1,
            color: '#06b6d4'
        },
        'contrarian': {
            name: 'Strategia Contrarian',
            desc: 'Evita i numeri pi√π giocati e frequenti',
            freqWeight: -0.3,
            delayWeight: 0.6,
            recentWeight: 0.1,
            color: '#8b5cf6',
            inverted: true
        },
        'mathematical': {
            name: 'Distribuzione Matematica',
            desc: 'Copre uniformemente tutto il range 1-90',
            freqWeight: 0.3,
            delayWeight: 0.3,
            recentWeight: 0.1,
            color: '#ec4899',
            special: 'spread'
        }
    };

    // Configurazione slider
    document.getElementById('freqWeight').addEventListener('input', function() {
        strategies.balanced.freqWeight = this.value / 100;
        document.getElementById('freqValue').textContent = this.value + '%';
    });

    document.getElementById('delayWeight').addEventListener('input', function() {
        strategies.balanced.delayWeight = this.value / 100;
        document.getElementById('delayValue').textContent = this.value + '%';
    });

    document.getElementById('recentWeight').addEventListener('input', function() {
        strategies.balanced.recentWeight = this.value / 100;
        document.getElementById('recentValue').textContent = this.value + '%';
    });

    document.getElementById('systemNumbers').addEventListener('input', function() {
        document.getElementById('systemNumbersValue').textContent = this.value;
    });

    function showSystemsGenerator() {
        if (!analysisData) {
            alert("Prima carica l'archivio e fai un'analisi!");
            return;
        }
        document.getElementById('results').style.display = 'none';
        document.getElementById('systemsPanel').style.display = 'block';
        document.getElementById('superSystemPanel').style.display = 'none';
        document.getElementById('megaSystemPanel').style.display = 'none';
        window.scrollTo({top: document.getElementById('systemsPanel').offsetTop - 20, behavior: 'smooth'});
    }

    // Database sistemi ridotti ottimizzati
    const reducedSystems = {
        7: {
            3: [[1,2,3,4,5,6], [1,2,3,4,5,7], [1,2,3,4,6,7], [1,2,3,5,6,7], [1,2,4,5,6,7], [1,3,4,5,6,7], [2,3,4,5,6,7]],
            4: [[1,2,3,4,5,6], [1,2,3,4,5,7], [1,2,3,4,6,7], [1,3,4,5,6,7]],
            5: [[1,2,3,4,5,6], [1,2,3,4,5,7]]
        },
        8: {
            3: [[1,2,3,4,5,6], [1,2,3,4,7,8], [1,2,5,6,7,8], [1,3,4,5,7,8], [1,3,4,6,7,8], [2,3,5,6,7,8], [2,4,5,6,7,8]],
            4: [[1,2,3,4,5,6], [1,2,3,7,8,4], [1,5,6,7,8,2], [3,4,5,6,7,8]],
            5: [[1,2,3,4,5,6], [1,2,3,7,8,4], [1,7,8,5,6,2]]
        },
        9: {
            3: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,4,5,7,8,9], [1,4,6,7,8,9], [2,4,5,6,7,8], [2,4,5,6,7,9], [3,5,6,7,8,9]],
            4: [[1,2,3,4,5,6], [1,2,7,8,9,3], [1,4,5,6,7,8], [1,4,5,6,7,9], [2,4,5,7,8,9], [3,6,7,8,9,4]],
            5: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,4,5,7,8,6], [2,4,6,7,8,9]]
        },
        10: {
            3: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,2,4,7,9,10], [1,3,5,7,8,10], [1,4,6,8,9,10], [2,3,6,7,9,10], [2,4,5,8,9,10], [3,4,5,6,8,10], [5,6,7,9,10,2]],
            4: [[1,2,3,4,5,6], [1,2,7,8,9,10], [1,3,4,7,8,9], [1,5,6,7,9,10], [2,4,5,6,8,10], [2,4,7,8,9,10], [3,5,6,8,9,10]],
            5: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,4,5,7,9,10], [1,6,7,8,9,10], [2,4,6,7,8,10]]
        },
        11: {
            3: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,2,4,7,10,11], [1,3,5,8,10,11], [1,4,6,8,9,11], [1,5,6,7,9,10], [2,3,6,7,10,11], [2,4,5,8,10,11], [2,6,8,9,10,11], [3,4,5,7,9,11], [3,4,6,8,9,10], [5,6,7,8,10,11]],
            4: [[1,2,3,4,5,6], [1,2,7,8,9,10], [1,3,4,7,8,11], [1,5,6,9,10,11], [1,7,9,10,11,2], [2,4,5,6,8,10], [2,4,7,9,10,11], [3,5,6,7,8,9], [3,6,8,9,10,11], [4,5,7,8,9,10]],
            5: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,4,5,7,10,11], [1,6,8,9,10,11], [2,4,6,7,9,10], [3,5,6,8,10,11]]
        },
        12: {
            3: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,2,4,7,10,11], [1,3,5,8,11,12], [1,4,6,9,10,12], [1,5,6,7,8,10], [1,9,10,11,12,2], [2,3,6,8,10,12], [2,4,5,8,9,11], [2,6,7,9,11,12], [3,4,5,7,10,12], [3,4,6,8,9,11], [3,7,9,10,11,12], [4,5,6,7,8,12], [5,6,8,9,10,11]],
            4: [[1,2,3,4,5,6], [1,2,7,8,9,10], [1,3,4,7,11,12], [1,5,6,9,11,12], [1,8,10,11,12,3], [2,4,5,6,8,11], [2,4,7,9,11,12], [2,6,9,10,11,12], [3,5,6,7,9,10], [3,8,9,10,11,12], [4,5,7,8,10,12], [4,6,8,9,10,11]],
            5: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,4,5,10,11,12], [1,6,7,10,11,12], [2,4,6,8,9,10], [2,5,7,9,11,12], [3,5,6,8,10,11], [3,4,7,8,11,12]]
        },
        13: {
            3: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,2,4,7,10,11], [1,3,5,8,12,13], [1,4,6,9,11,13], [1,5,7,9,10,12], [1,6,8,10,11,12], [2,3,6,8,11,13], [2,4,5,9,12,13], [2,6,7,10,12,13], [2,8,9,10,11,13], [3,4,5,7,11,12], [3,4,6,9,10,13], [3,7,9,11,12,13], [4,5,6,8,10,13], [4,7,8,9,11,12], [5,6,7,8,11,13], [5,8,9,10,12,13]],
            4: [[1,2,3,4,5,6], [1,2,7,8,9,10], [1,3,4,11,12,13], [1,5,6,9,11,13], [1,7,10,11,12,13], [2,4,5,6,8,12], [2,4,7,10,12,13], [2,6,9,11,12,13], [3,5,7,8,9,11], [3,6,8,10,11,13], [3,9,10,11,12,13], [4,5,7,9,10,11], [4,6,8,9,10,12], [5,7,8,10,12,13]],
            5: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,4,5,10,12,13], [1,6,7,11,12,13], [2,4,6,8,10,11], [2,5,7,9,11,13], [3,5,6,8,11,12], [3,4,7,9,10,13], [4,8,9,11,12,13]]
        },
        14: {
            3: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,2,4,7,10,11], [1,3,5,8,13,14], [1,4,6,9,12,14], [1,5,7,10,12,13], [1,6,8,11,12,14], [1,9,10,11,13,14], [2,3,6,9,11,14], [2,4,5,10,13,14], [2,6,7,11,13,14], [2,8,10,11,12,14], [3,4,5,7,12,13], [3,4,6,10,11,13], [3,7,9,12,13,14], [4,5,6,8,11,14], [4,7,8,9,12,13], [5,6,7,9,10,14], [5,8,9,11,12,13], [6,8,9,10,12,13], [7,8,10,11,13,14]],
            4: [[1,2,3,4,5,6], [1,2,7,8,9,10], [1,3,4,11,13,14], [1,5,6,10,12,14], [1,7,9,12,13,14], [1,8,11,12,13,14], [2,4,5,6,9,13], [2,4,7,11,13,14], [2,6,8,10,12,13], [2,9,10,11,12,14], [3,5,7,9,10,12], [3,6,8,9,11,14], [3,10,11,12,13,14], [4,5,7,8,10,11], [4,6,8,9,10,13], [5,7,9,11,13,14], [6,7,10,11,12,13]],
            5: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,4,5,10,13,14], [1,6,7,11,13,14], [1,9,10,12,13,14], [2,4,6,9,11,12], [2,5,7,10,12,14], [3,5,6,8,12,13], [3,4,7,9,11,13], [4,8,10,11,12,14], [5,8,9,10,11,13]]
        },
        15: {
            3: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,2,4,7,10,11], [1,3,5,8,14,15], [1,4,6,9,13,15], [1,5,7,11,13,14], [1,6,8,12,13,15], [1,9,10,12,14,15], [1,11,12,13,14,15], [2,3,6,10,12,15], [2,4,5,11,14,15], [2,6,7,12,14,15], [2,8,11,12,13,15], [2,9,10,11,13,14], [3,4,5,7,13,14], [3,4,6,11,12,14], [3,7,9,13,14,15], [3,8,10,11,12,15], [4,5,6,8,12,15], [4,7,8,10,13,14], [5,6,7,10,11,15], [5,8,9,12,13,14], [6,9,10,11,13,14], [7,8,9,11,12,15], [7,9,10,12,13,15], [8,9,10,11,14,15]],
            4: [[1,2,3,4,5,6], [1,2,7,8,9,10], [1,3,4,11,14,15], [1,5,6,11,13,15], [1,7,10,13,14,15], [1,8,9,12,14,15], [1,11,12,13,14,15], [2,4,5,6,10,14], [2,4,7,12,14,15], [2,6,9,11,13,14], [2,8,10,12,13,15], [3,5,7,9,11,13], [3,6,8,10,12,14], [3,9,10,12,13,15], [4,5,7,8,11,12], [4,6,8,9,11,14], [4,9,10,11,13,15], [5,7,10,12,14,15], [5,8,9,10,13,14], [6,7,11,12,13,15], [6,9,10,12,14,15]],
            5: [[1,2,3,4,5,6], [1,2,3,7,8,9], [1,4,5,10,14,15], [1,6,7,12,14,15], [1,9,11,13,14,15], [2,4,6,10,12,13], [2,5,7,11,13,15], [2,8,9,10,11,14], [3,5,6,9,13,14], [3,4,7,10,11,14], [3,8,10,12,13,15], [4,8,9,11,12,15], [5,8,10,11,12,13], [6,9,10,11,12,15]]
        }
    };

    function generateReducedSystem() {
        const numCount = parseInt(document.getElementById('systemNumbers').value);
        const guarantee = parseInt(document.getElementById('systemGuarantee').value);
        const source = document.getElementById('systemSource').value;

        if (!reducedSystems[numCount] || !reducedSystems[numCount][guarantee]) {
            alert('Sistema non disponibile per questa configurazione!');
            return;
        }

        // Genera pool di numeri dalla strategia scelta
        let poolNumbers = [];
        if (source === 'mixed') {
            // Mix intelligente: prendi dai migliori di ogni strategia
            const balanced = generateStrategyResults(analysisData.stats, 'balanced').sestina;
            const hot = generateStrategyResults(analysisData.stats, 'hotNumbers').sestina;
            const cold = generateStrategyResults(analysisData.stats, 'coldNumbers').sestina;

            poolNumbers = [...new Set([...balanced, ...hot, ...cold])];
        } else {
            const result = generateStrategyResults(analysisData.stats, source);
            poolNumbers = [...result.sestina];

            // Aggiungi altri numeri dalla stessa strategia fino a raggiungere numCount
            const allRanked = Object.keys(analysisData.stats.main).slice(1)
                .map(Number)
                .sort((a, b) => {
                    const config = strategies[source];
                    const scoreA = (analysisData.stats.main[a].f * config.freqWeight) +
                        (analysisData.stats.main[a].d * config.delayWeight);
                    const scoreB = (analysisData.stats.main[b].f * config.freqWeight) +
                        (analysisData.stats.main[b].d * config.delayWeight);
                    return scoreB - scoreA;
                });

            for (let num of allRanked) {
                if (!poolNumbers.includes(num)) {
                    poolNumbers.push(num);
                }
                if (poolNumbers.length >= numCount) break;
            }
        }

        poolNumbers = poolNumbers.slice(0, numCount).sort((a, b) => a - b);

        // Genera combinazioni dal sistema ridotto
        const systemTemplate = reducedSystems[numCount][guarantee];
        const combinations = systemTemplate.map(template =>
            template.map(idx => poolNumbers[idx - 1])
        );

        displayReducedSystem(poolNumbers, combinations, guarantee, numCount);
    }

    function displayReducedSystem(pool, combinations, guarantee, numCount) {
        const costPerCombo = 1; // 1‚Ç¨ per combinazione
        const totalCost = combinations.length * costPerCombo;

        let html = `
            <div class="system-summary">
                <h3 style="color: #fbbf24; margin-bottom: 15px; text-align: center;">
                    üìä SISTEMA GENERATO
                </h3>
                <div style="text-align: center; margin: 20px 0;">
                    <div class="guarantee-badge">Garanzia ${guarantee}</div>
                    <p style="color: #94a3b8; margin-top: 10px;">
                        Se tra questi ${numCount} numeri ci sono i 6 vincenti, fai ALMENO un ${guarantee}
                    </p>
                </div>

                <div style="background: #0f172a; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4 style="color: #f8fafc; margin-bottom: 15px; text-align: center;">
                        üéØ I Tuoi ${numCount} Numeri
                    </h4>
                    <div class="balls">
                        ${pool.map(n => `<div class="ball system">${n}</div>`).join('')}
                    </div>
                </div>

                <div class="system-summary-grid">
                    <div class="system-stat">
                        <div class="system-stat-value">${combinations.length}</div>
                        <div class="system-stat-label">Combinazioni</div>
                    </div>
                    <div class="system-stat">
                        <div class="system-stat-value">${totalCost}‚Ç¨</div>
                        <div class="system-stat-label">Costo Totale</div>
                    </div>
                    <div class="system-stat">
                        <div class="system-stat-value">${numCount}</div>
                        <div class="system-stat-label">Numeri Giocati</div>
                    </div>
                    <div class="system-stat">
                        <div class="system-stat-value">${guarantee}</div>
                        <div class="system-stat-label">Premio Garantito</div>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <h4>üí° Come Funziona</h4>
                <p>
                    Questo sistema ridotto copre <strong>${combinations.length} sestine</strong> in modo matematicamente ottimizzato.
                    Se tra i tuoi ${numCount} numeri ci sono tutti e 6 i numeri vincenti,
                    hai la GARANZIA MATEMATICA di fare almeno un <strong>${guarantee}</strong>.
                </p>
                <p style="margin-top: 10px;">
                    Rispetto a giocare tutte le possibili sestine da ${numCount} numeri (che sarebbero ${calculateCombinations(numCount, 6)} combinazioni!),
                    questo sistema ti fa risparmiare <strong>${calculateCombinations(numCount, 6) - combinations.length}</strong> combinazioni
                    mantenendo la garanzia.
                </p>
            </div>

            <h3 style="color: #f8fafc; margin: 30px 0 20px 0; text-align: center;">
                üìã Le Tue ${combinations.length} Sestine da Giocare
            </h3>
            <div style="max-height: 600px; overflow-y: auto; background: #0f172a; padding: 15px; border-radius: 10px;">
                ${combinations.map((combo, idx) => `
                    <div class="combination-row">
                        <span class="combination-label">Sestina ${idx + 1}:</span>
                        ${combo.map(n => `<div class="ball">${n}</div>`).join('')}
                    </div>
                `).join('')}
            </div>

            <div class="info-box" style="margin-top: 30px; background: #1e3a1c; border-left-color: #10b981;">
                <h4 style="color: #10b981;">‚úÖ Cosa Fare Ora</h4>
                <p>
                    1. <strong>Copia queste ${combinations.length} sestine</strong> su un foglio o screenshot<br>
                    2. <strong>Gioca tutte le combinazioni</strong> alla prossima estrazione<br>
                    3. <strong>Costo totale: ${totalCost}‚Ç¨</strong> (${costPerCombo}‚Ç¨ per sestina)<br>
                    4. Se tra i tuoi ${numCount} numeri ci sono i 6 vincenti, sei SICURO di vincere almeno un ${guarantee}!
                </p>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button onclick="printSystem()" style="padding: 12px 30px; background: #10b981; color: white; margin: 0 10px;">
                    üñ®Ô∏è STAMPA SISTEMA
                </button>
                <button onclick="downloadSystem(${JSON.stringify(combinations)})" style="padding: 12px 30px; background: #3b82f6; color: white; margin: 0 10px;">
                    üíæ SCARICA TXT
                </button>
                <button onclick="showSystemsGenerator()" style="padding: 12px 30px; background: #334155; color: #94a3b8; margin: 0 10px;">
                    üîÑ NUOVO SISTEMA
                </button>
            </div>
        `;

        document.getElementById('systemResults').innerHTML = html;
    }

    function calculateCombinations(n, k) {
        let result = 1;
        for (let i = 1; i <= k; i++) {
            result *= (n - k + i) / i;
        }
        return Math.round(result);
    }

    function printSystem() {
        window.print();
    }

    function downloadSystem(combinations) {
        let text = `SISTEMA RIDOTTO SUPERENALOTTO\n`;
        text += '='.repeat(50) + '\n\n';
        text += `Data generazione: ${new Date().toLocaleString('it-IT')}\n`;
        text += `Totale combinazioni: ${combinations.length}\n`;
        text += `Costo totale: ${combinations.length}‚Ç¨\n`;
        text += '\n' + '='.repeat(50) + '\n\n';

        combinations.forEach((combo, idx) => {
            text += `Sestina ${String(idx + 1).padStart(3, '0')}: ${combo.join(', ')}\n`;
        });

        text += '\n' + '='.repeat(50) + '\n';
        text += 'BUONA FORTUNA! üçÄ\n';

        const blob = new Blob([text], {type: 'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `sistema_ridotto_${combinations.length}_sestine.txt`;
        a.click();
    }

    document.getElementById('superBudget').addEventListener('input', function() {
        document.getElementById('superBudgetValue').textContent = this.value + '‚Ç¨';
    });

    function showSuperSystem() {
        if (!analysisData) {
            alert("Prima carica l'archivio e fai un'analisi!");
            return;
        }
        document.getElementById('results').style.display = 'none';
        document.getElementById('systemsPanel').style.display = 'none';
        document.getElementById('superSystemPanel').style.display = 'block';
        document.getElementById('megaSystemPanel').style.display = 'none';
        window.scrollTo({top: document.getElementById('superSystemPanel').offsetTop - 20, behavior: 'smooth'});
    }

    function showMegaSystem() {
        if (!analysisData) {
            alert("Prima carica l'archivio e fai un'analisi!");
            return;
        }
        document.getElementById('results').style.display = 'none';
        document.getElementById('systemsPanel').style.display = 'none';
        document.getElementById('superSystemPanel').style.display = 'none';
        document.getElementById('megaSystemPanel').style.display = 'block';
        window.scrollTo({top: document.getElementById('megaSystemPanel').offsetTop - 20, behavior: 'smooth'});
    }

    function generateMegaSystem() {
        const diversification = document.getElementById('megaDiversification').value;
        const TARGET_COMBINATIONS = 100;

        // Raccogli strategie selezionate
        const selectedStrategies = [];
        if (document.getElementById('megaIncludeCaldi').checked) selectedStrategies.push('hotNumbers');
        if (document.getElementById('megaIncludeFreddi').checked) selectedStrategies.push('coldNumbers');
        if (document.getElementById('megaIncludeBalanced').checked) selectedStrategies.push('balanced');
        if (document.getElementById('megaIncludeRecent').checked) selectedStrategies.push('recentFocused');
        if (document.getElementById('megaIncludeContrarian').checked) selectedStrategies.push('contrarian');
        if (document.getElementById('megaIncludeMath').checked) selectedStrategies.push('mathematical');

        if (selectedStrategies.length < 2) {
            alert('Seleziona almeno 2 strategie per il Mega Sistema!');
            return;
        }

        // Genera pool di numeri per ogni strategia (top 10 per strategia invece di 6)
        const allRankedNumbers = [];
        selectedStrategies.forEach(strat => {
            const config = strategies[strat];
            let ranked;

            if (config.special === 'spread') {
                // Strategia spread - prendi i migliori di ogni zona
                const zones = [[1,15], [16,30], [31,45], [46,60], [61,75], [76,90]];
                ranked = [];
                zones.forEach(([min, max]) => {
                    const zoneNums = Object.keys(analysisData.stats.main).slice(min, max + 1)
                        .map(Number)
                        .sort((a, b) => {
                            const scoreA = (analysisData.stats.main[a].f * config.freqWeight) + (analysisData.stats.main[a].d * config.delayWeight);
                            const scoreB = (analysisData.stats.main[b].f * config.freqWeight) + (analysisData.stats.main[b].d * config.delayWeight);
                            return scoreB - scoreA;
                        });
                    ranked.push(...zoneNums.slice(0, 3)); // Top 3 per zona
                });
            } else if (config.inverted) {
                // Strategia contrarian
                ranked = Object.keys(analysisData.stats.main).slice(1)
                    .map(Number)
                    .filter(n => n % 5 !== 0) // Escludi multipli di 5
                    .sort((a, b) => {
                        const scoreA = (-analysisData.stats.main[a].f * 0.3) + (analysisData.stats.main[a].d * 0.7);
                        const scoreB = (-analysisData.stats.main[b].f * 0.3) + (analysisData.stats.main[b].d * 0.7);
                        return scoreB - scoreA;
                    })
                    .slice(0, 15);
            } else {
                // Strategia standard
                ranked = Object.keys(analysisData.stats.main).slice(1)
                    .map(Number)
                    .sort((a, b) => {
                        const scoreA = (analysisData.stats.main[a].f * config.freqWeight) +
                                      (analysisData.stats.main[a].d * config.delayWeight) +
                                      (analysisData.stats.main[a].recentF * config.recentWeight * 10);
                        const scoreB = (analysisData.stats.main[b].f * config.freqWeight) +
                                      (analysisData.stats.main[b].d * config.delayWeight) +
                                      (analysisData.stats.main[b].recentF * config.recentWeight * 10);
                        return scoreB - scoreA;
                    })
                    .slice(0, 15);
            }

            // Aggiungi i numeri con peso basato sulla posizione nel ranking
            ranked.forEach((num, idx) => {
                allRankedNumbers.push({
                    number: num,
                    strategy: strat,
                    score: 15 - idx, // Pi√π alto = migliore
                    color: config.color
                });
            });
        });

        // Crea un pool di numeri unici con punteggio aggregato
        const numberScores = {};
        allRankedNumbers.forEach(item => {
            if (!numberScores[item.number]) {
                numberScores[item.number] = { total: 0, count: 0, strategies: [] };
            }
            numberScores[item.number].total += item.score;
            numberScores[item.number].count++;
            numberScores[item.number].strategies.push(item.strategy);
        });

        // Ordina i numeri per punteggio totale
        const rankedPool = Object.entries(numberScores)
            .map(([num, data]) => ({
                number: parseInt(num),
                score: data.total,
                appearances: data.count,
                strategies: data.strategies
            }))
            .sort((a, b) => b.score - a.score);

        // Prendi i migliori numeri per il pool (almeno 25 numeri per 100 combinazioni diverse)
        const poolSize = Math.min(35, rankedPool.length);
        const megaPool = rankedPool.slice(0, poolSize).map(n => n.number).sort((a, b) => a - b);

        // Genera 100 sestine con diversificazione
        const combinations = generateMegaCombinations(megaPool, TARGET_COMBINATIONS, diversification, analysisData.stats);

        // Visualizza risultati
        displayMegaSystem(rankedPool.slice(0, poolSize), combinations, selectedStrategies, diversification);
    }

    function generateMegaCombinations(pool, targetCount, diversification, stats) {
        const combinations = [];
        const usedKeys = new Set();
        const maxAttempts = targetCount * 50; // Limita i tentativi
        let attempts = 0;

        // Funzione per calcolare la somma di una sestina
        const getSum = (combo) => combo.reduce((a, b) => a + b, 0);

        // Funzione per contare pari/dispari
        const getEvenOdd = (combo) => {
            const even = combo.filter(n => n % 2 === 0).length;
            return { even, odd: 6 - even };
        };

        // Funzione per verificare la distribuzione nelle zone
        const getZoneDistribution = (combo) => {
            const zones = [0, 0, 0, 0, 0, 0]; // 6 zone
            combo.forEach(n => {
                const zoneIdx = Math.min(5, Math.floor((n - 1) / 15));
                zones[zoneIdx]++;
            });
            return zones;
        };

        // Funzione per calcolare il punteggio di diversit√†
        const getDiversityScore = (combo, existingCombos) => {
            let score = 0;
            const comboSet = new Set(combo);

            existingCombos.forEach(existing => {
                const existingSet = new Set(existing);
                let overlap = 0;
                comboSet.forEach(n => { if (existingSet.has(n)) overlap++; });
                // Penalizza combinazioni troppo simili
                if (overlap >= 5) score -= 10;
                else if (overlap >= 4) score -= 3;
            });

            return score;
        };

        // Genera combinazioni base dalle strategie
        const strategyCombos = [];
        ['hotNumbers', 'coldNumbers', 'balanced', 'recentFocused', 'contrarian', 'mathematical'].forEach(strat => {
            try {
                const result = generateStrategyResults(stats, strat);
                if (result.sestina && result.sestina.length === 6) {
                    const key = result.sestina.sort((a,b) => a-b).join(',');
                    if (!usedKeys.has(key)) {
                        strategyCombos.push([...result.sestina].sort((a,b) => a-b));
                        usedKeys.add(key);
                    }
                }
            } catch (e) {}
        });

        // Aggiungi le sestine delle strategie
        combinations.push(...strategyCombos);

        // Genera il resto delle combinazioni
        while (combinations.length < targetCount && attempts < maxAttempts) {
            attempts++;

            // Genera una sestina casuale dal pool
            const combo = [];
            const available = [...pool];

            while (combo.length < 6 && available.length > 0) {
                const idx = Math.floor(Math.random() * available.length);
                combo.push(available[idx]);
                available.splice(idx, 1);
            }

            if (combo.length !== 6) continue;

            combo.sort((a, b) => a - b);
            const key = combo.join(',');

            // Verifica duplicato
            if (usedKeys.has(key)) continue;

            // Applica filtri basati sulla diversificazione
            const sum = getSum(combo);
            const { even, odd } = getEvenOdd(combo);
            const zones = getZoneDistribution(combo);

            let accept = false;

            switch (diversification) {
                case 'sum':
                    // Privilegia somme tra 200-340
                    accept = sum >= 180 && sum <= 360;
                    break;

                case 'coverage':
                    // Privilegia combinazioni con numeri diversi da quelle esistenti
                    const diversityScore = getDiversityScore(combo, combinations);
                    accept = diversityScore >= -5 || combinations.length < 20;
                    break;

                case 'zones':
                    // Privilegia distribuzione uniforme nelle zone
                    const maxZone = Math.max(...zones);
                    const minZone = Math.min(...zones.filter(z => z > 0));
                    accept = maxZone <= 3 && zones.filter(z => z > 0).length >= 3;
                    break;

                case 'balanced':
                default:
                    // Mix di tutti i criteri
                    const sumOk = sum >= 180 && sum <= 360;
                    const evenOddOk = even >= 2 && odd >= 2;
                    const zonesOk = zones.filter(z => z > 0).length >= 3;
                    accept = (sumOk && evenOddOk) || (sumOk && zonesOk) || (evenOddOk && zonesOk);
                    break;
            }

            if (accept || combinations.length < 30) { // Sii pi√π permissivo per le prime 30
                combinations.push(combo);
                usedKeys.add(key);
            }
        }

        // Se non abbiamo raggiunto 100, genera le rimanenti senza filtri
        while (combinations.length < targetCount && attempts < maxAttempts * 2) {
            attempts++;
            const combo = [];
            const available = [...pool];

            while (combo.length < 6 && available.length > 0) {
                const idx = Math.floor(Math.random() * available.length);
                combo.push(available[idx]);
                available.splice(idx, 1);
            }

            if (combo.length !== 6) continue;

            combo.sort((a, b) => a - b);
            const key = combo.join(',');

            if (!usedKeys.has(key)) {
                combinations.push(combo);
                usedKeys.add(key);
            }
        }

        return combinations.slice(0, targetCount);
    }

    function displayMegaSystem(poolData, combinations, selectedStrategies, diversification) {
        const totalCost = combinations.length;

        // Statistiche sulle combinazioni generate
        const sums = combinations.map(c => c.reduce((a, b) => a + b, 0));
        const avgSum = Math.round(sums.reduce((a, b) => a + b, 0) / sums.length);
        const minSum = Math.min(...sums);
        const maxSum = Math.max(...sums);

        // Conta numeri usati
        const usedNumbers = new Set();
        combinations.forEach(c => c.forEach(n => usedNumbers.add(n)));

        let html = `
            <div class="mega-stat" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);">
                <div class="mega-stat-value">${combinations.length}</div>
                <div class="mega-stat-label">Sestine Generate</div>
            </div>

            <div class="super-system-card" style="border-color: #f97316;">
                <h3 style="color: #f97316; margin-bottom: 20px; text-align: center;">
                    üìä ANALISI MEGA SISTEMA
                </h3>

                <table class="comparison-table">
                    <tr><th>Metrica</th><th>Valore</th></tr>
                    <tr><td><strong>Sestine Generate</strong></td><td style="color: #f97316; font-weight: bold;">${combinations.length}</td></tr>
                    <tr><td><strong>Costo Totale</strong></td><td style="color: #10b981; font-weight: bold;">${totalCost}‚Ç¨</td></tr>
                    <tr><td><strong>Strategie Combinate</strong></td><td>${selectedStrategies.length}</td></tr>
                    <tr><td><strong>Diversificazione</strong></td><td style="color: #f97316;">${diversification.toUpperCase()}</td></tr>
                    <tr><td><strong>Pool Numeri</strong></td><td>${poolData.length} numeri</td></tr>
                    <tr><td><strong>Numeri Utilizzati</strong></td><td>${usedNumbers.size} su 90</td></tr>
                    <tr><td><strong>Somma Media</strong></td><td>${avgSum}</td></tr>
                    <tr><td><strong>Range Somme</strong></td><td>${minSum} - ${maxSum}</td></tr>
                </table>
            </div>

            <div class="strategy-pool" style="margin-top: 20px;">
                <h4 style="color: #f97316; margin-bottom: 15px;">üéØ Pool Numeri Selezionati (Top ${poolData.length})</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                    ${poolData.map(item => `
                        <span style="background: linear-gradient(135deg, #f97316, #ea580c); color: white; padding: 8px 12px; border-radius: 8px; font-weight: bold; font-size: 1.1rem;">
                            ${item.number}
                            <span style="font-size: 0.7rem; opacity: 0.8;">(${item.appearances}x)</span>
                        </span>
                    `).join('')}
                </div>
            </div>

            <div class="info-box" style="background: #1e3a1c; border-left-color: #10b981; margin-top: 20px;">
                <h4 style="color: #10b981;">üí° Come Funziona il Mega Sistema</h4>
                <p style="color: #d1fae5; line-height: 1.8;">
                    Il Mega Sistema combina <strong>${selectedStrategies.length} strategie diverse</strong> per creare un pool di ${poolData.length} numeri ottimizzati.
                    Da questo pool vengono generate <strong>100 sestine uniche</strong> con il criterio di diversificazione "${diversification}".
                    <br><br>
                    <strong>Copertura:</strong> ${usedNumbers.size} numeri diversi utilizzati su 90 possibili (${Math.round(usedNumbers.size/90*100)}% di copertura).
                </p>
            </div>

            <div style="background: #0f172a; border: 2px solid #f97316; border-radius: 15px; padding: 25px; margin-top: 25px;">
                <h3 style="color: #f97316; text-align: center; margin-bottom: 20px;">
                    üé≤ Le Tue ${combinations.length} Sestine Mega Sistema
                </h3>

                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; max-height: 600px; overflow-y: auto; padding: 10px;">
                    ${combinations.map((combo, idx) => {
                        const sum = combo.reduce((a, b) => a + b, 0);
                        const even = combo.filter(n => n % 2 === 0).length;
                        return `
                            <div style="background: #1e293b; padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 3px solid #f97316;">
                                <span style="color: #64748b; font-size: 0.8rem; min-width: 30px;">#${idx + 1}</span>
                                <span style="color: #f8fafc; font-weight: bold; font-family: monospace; letter-spacing: 2px;">
                                    ${combo.map(n => n.toString().padStart(2, '0')).join(' - ')}
                                </span>
                                <span style="color: #94a3b8; font-size: 0.7rem;">Œ£${sum} P${even}/D${6-even}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                <button onclick="printMegaSystem()" style="padding: 15px 30px; background: #10b981; color: white; border-radius: 10px; border: 2px solid #34d399;">
                    üñ®Ô∏è STAMPA
                </button>
                <button onclick="downloadMegaSystem()" style="padding: 15px 30px; background: #3b82f6; color: white; border-radius: 10px; border: 2px solid #60a5fa;">
                    üíæ SCARICA TXT
                </button>
                <button onclick="showMegaSystem()" style="padding: 15px 30px; background: #334155; color: #94a3b8; border-radius: 10px; border: 2px solid #475569;">
                    üîÑ RIGENERA
                </button>
            </div>
        `;

        document.getElementById('megaSystemResults').innerHTML = html;

        // Salva le combinazioni per download/stampa
        window.lastMegaCombinations = combinations;
    }

    function printMegaSystem() {
        if (!window.lastMegaCombinations) return;

        const printContent = `
            <html>
            <head>
                <title>Mega Sistema - 100 Sestine</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    h1 { color: #f97316; text-align: center; }
                    .combo { padding: 5px; border-bottom: 1px solid #eee; font-family: monospace; }
                    .combo:nth-child(even) { background: #f5f5f5; }
                </style>
            </head>
            <body>
                <h1>üöÄ MEGA SISTEMA - 100 SESTINE</h1>
                <p style="text-align: center;">Generato il: ${new Date().toLocaleString('it-IT')}</p>
                <hr>
                ${window.lastMegaCombinations.map((combo, idx) =>
                    `<div class="combo">${(idx + 1).toString().padStart(3, '0')}. ${combo.map(n => n.toString().padStart(2, '0')).join(' - ')}</div>`
                ).join('')}
            </body>
            </html>
        `;

        const printWindow = window.open('', '_blank');
        printWindow.document.write(printContent);
        printWindow.document.close();
        printWindow.print();
    }

    function downloadMegaSystem() {
        if (!window.lastMegaCombinations) return;

        let content = "MEGA SISTEMA - 100 SESTINE\n";
        content += "Generato il: " + new Date().toLocaleString('it-IT') + "\n";
        content += "=".repeat(40) + "\n\n";

        window.lastMegaCombinations.forEach((combo, idx) => {
            content += `${(idx + 1).toString().padStart(3, '0')}. ${combo.map(n => n.toString().padStart(2, '0')).join(' - ')}\n`;
        });

        content += "\n" + "=".repeat(40) + "\n";
        content += "Costo totale: " + window.lastMegaCombinations.length + "‚Ç¨\n";

        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `mega_sistema_100_${new Date().toISOString().slice(0,10)}.txt`;
        a.click();
        URL.revokeObjectURL(url);
    }

    function generateSuperSystem() {
        const budget = parseInt(document.getElementById('superBudget').value);
        const mode = document.getElementById('superMode').value;

        // Raccogli strategie selezionate
        const selectedStrategies = [];
        if (document.getElementById('includeCaldi').checked) selectedStrategies.push('hotNumbers');
        if (document.getElementById('includeFreddi').checked) selectedStrategies.push('coldNumbers');
        if (document.getElementById('includeBalanced').checked) selectedStrategies.push('balanced');
        if (document.getElementById('includeRecent').checked) selectedStrategies.push('recentFocused');
        if (document.getElementById('includeContrarian').checked) selectedStrategies.push('contrarian');
        if (document.getElementById('includeMath').checked) selectedStrategies.push('mathematical');

        if (selectedStrategies.length < 2) {
            alert('Seleziona almeno 2 strategie per il Super Sistema!');
            return;
        }

        // Genera pool di numeri per ogni strategia
        const pools = {};
        selectedStrategies.forEach(strat => {
            const result = generateStrategyResults(analysisData.stats, strat);
            pools[strat] = {
                name: strategies[strat].name,
                color: strategies[strat].color,
                numbers: result.sestina,
                stars: result.stars
            };
        });

        let finalCombinations = [];
        let poolDescription = '';

        if (mode === 'union') {
            // UNION: prendi tutti i numeri unici da tutte le strategie
            const allNumbers = new Set();
            Object.values(pools).forEach(pool => {
                pool.numbers.forEach(n => allNumbers.add(n));
            });
            const uniqueNumbers = Array.from(allNumbers).sort((a, b) => a - b);

            // Genera combinazioni fino al budget
            const maxCombos = Math.floor(budget);
            finalCombinations = generateSmartCombinations(uniqueNumbers, maxCombos);
            poolDescription = `Pool di ${uniqueNumbers.length} numeri unici da tutte le strategie`;

        } else if (mode === 'intersection') {
            // INTERSECTION: solo numeri che appaiono in almeno 2 strategie
            const numCount = {};
            Object.values(pools).forEach(pool => {
                pool.numbers.forEach(n => {
                    numCount[n] = (numCount[n] || 0) + 1;
                });
            });
            const commonNumbers = Object.keys(numCount)
                .filter(n => numCount[n] >= 2)
                .map(Number)
                .sort((a, b) => a - b);

            if (commonNumbers.length < 6) {
                alert('Non ci sono abbastanza numeri comuni! Prova con Union o Hybrid.');
                return;
            }

            const maxCombos = Math.floor(budget);
            finalCombinations = generateSmartCombinations(commonNumbers, maxCombos);
            poolDescription = `Pool di ${commonNumbers.length} numeri comuni (presenti in 2+ strategie)`;

        } else if (mode === 'hybrid') {
            // HYBRID: 50% union + 50% intersection
            const allNumbers = new Set();
            const numCount = {};

            Object.values(pools).forEach(pool => {
                pool.numbers.forEach(n => {
                    allNumbers.add(n);
                    numCount[n] = (numCount[n] || 0) + 1;
                });
            });

            const commonNumbers = Object.keys(numCount)
                .filter(n => numCount[n] >= 2)
                .map(Number);

            const uniqueNumbers = Array.from(allNumbers);
            const otherNumbers = uniqueNumbers.filter(n => !commonNumbers.includes(n));

            // Prendi 50% comuni + 50% altri
            const targetSize = Math.min(15, Math.ceil(uniqueNumbers.length * 0.8));
            const hybridPool = [
                ...commonNumbers.slice(0, Math.ceil(targetSize / 2)),
                ...otherNumbers.slice(0, Math.floor(targetSize / 2))
            ].sort((a, b) => a - b);

            const maxCombos = Math.floor(budget);
            finalCombinations = generateSmartCombinations(hybridPool, maxCombos);
            poolDescription = `Pool ibrido di ${hybridPool.length} numeri (50% comuni + 50% unici)`;

        } else if (mode === 'megasystem') {
            // MEGASYSTEM: tutte le sestine di tutte le strategie (rimozione duplicati)
            const allCombos = new Set();
            Object.values(pools).forEach(pool => {
                const comboKey = pool.numbers.sort((a,b) => a-b).join(',');
                allCombos.add(comboKey);
            });

            finalCombinations = Array.from(allCombos).map(combo =>
                combo.split(',').map(Number)
            );

            // Se supera il budget, prendi le prime N
            if (finalCombinations.length > budget) {
                finalCombinations = finalCombinations.slice(0, budget);
            }

            poolDescription = `Tutte le sestine delle strategie selezionate (duplicati rimossi)`;
        }

        displaySuperSystem(pools, finalCombinations, budget, mode, poolDescription, selectedStrategies);
    }

    function generateSmartCombinations(pool, maxCount) {
        if (pool.length < 6) return [];

        const combinations = [];
        const poolSize = pool.length;

        if (poolSize === 6) {
            return [pool];
        }

        if (poolSize <= 12) {
            // Sistema ridotto per pool piccoli
            const systemSize = Math.min(poolSize, 10);
            const guarantee = poolSize >= 10 ? 4 : 3;

            if (reducedSystems[systemSize] && reducedSystems[systemSize][guarantee]) {
                const template = reducedSystems[systemSize][guarantee];
                template.forEach(t => {
                    combinations.push(t.map(idx => pool[idx - 1]));
                });
            }
        }

        // Se non abbiamo abbastanza combinazioni, genera casualmente
        while (combinations.length < maxCount && combinations.length < 100) {
            const combo = [];
            const used = new Set();

            while (combo.length < 6) {
                const idx = Math.floor(Math.random() * pool.length);
                const num = pool[idx];
                if (!used.has(num)) {
                    combo.push(num);
                    used.add(num);
                }
            }

            const comboKey = combo.sort((a,b) => a-b).join(',');
            if (!combinations.some(c => c.join(',') === comboKey)) {
                combinations.push(combo.sort((a,b) => a-b));
            }
        }

        return combinations.slice(0, maxCount);
    }

    function displaySuperSystem(pools, combinations, budget, mode, description, strategies) {
        const actualCost = combinations.length;
        const savings = budget - actualCost;

        let html = `
            <div class="mega-stat">
                <div class="mega-stat-value">${combinations.length}</div>
                <div class="mega-stat-label">Sestine Generate</div>
            </div>

            <div class="super-system-card">
                <h3 style="color: #a855f7; margin-bottom: 20px; text-align: center;">
                    üìä ANALISI SUPER SISTEMA
                </h3>

                <table class="comparison-table">
                    <tr>
                        <th>Metrica</th>
                        <th>Valore</th>
                    </tr>
                    <tr>
                        <td><strong>Modalit√†</strong></td>
                        <td style="color: #a855f7;">${mode.toUpperCase()}</td>
                    </tr>
                    <tr>
                        <td><strong>Strategie Combinate</strong></td>
                        <td>${strategies.length}</td>
                    </tr>
                    <tr>
                        <td><strong>Descrizione Pool</strong></td>
                        <td>${description}</td>
                    </tr>
                    <tr>
                        <td><strong>Budget Previsto</strong></td>
                        <td>${budget}‚Ç¨</td>
                    </tr>
                    <tr>
                        <td><strong>Costo Effettivo</strong></td>
                        <td style="color: #10b981; font-weight: bold;">${actualCost}‚Ç¨</td>
                    </tr>
                    <tr>
                        <td><strong>Risparmio</strong></td>
                        <td style="color: ${savings > 0 ? '#10b981' : '#ef4444'};">${savings}‚Ç¨</td>
                    </tr>
                </table>
            </div>

            <div class="strategy-pool">
                ${Object.entries(pools).map(([key, pool]) => `
                    <div class="strategy-pool-card" style="border-left-color: ${pool.color};">
                        <h4 style="color: ${pool.color}; margin-bottom: 10px;">${pool.name}</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                            ${pool.numbers.map(n =>
            `<span style="background: ${pool.color}; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold;">${n}</span>`
        ).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>

            <div class="info-box" style="background: #1e3a1c; border-left-color: #10b981;">
                <h4 style="color: #10b981;">üí° Come Funziona Questo Super Sistema</h4>
                <p>
                    ${getModeExplanation(mode, strategies.length)}
                </p>
            </div>

            ${actualCost > 50 ? `
                <div class="warning-box">
                    <h4>‚ö†Ô∏è ATTENZIONE - Sistema Costoso</h4>
                    <p>
                        Questo sistema costa <strong>${actualCost}‚Ç¨</strong>. Assicurati che sia compatibile con il tuo budget per il gioco responsabile.
                        Ricorda: anche con tante combinazioni, la probabilit√† di vincita rimane molto bassa.
                    </p>
                </div>
            ` : ''}

            <h3 style="color: #a855f7; margin: 30px 0 20px 0; text-align: center;">
                üé≤ Le Tue ${combinations.length} Sestine Super Sistema
            </h3>
            <div style="max-height: 600px; overflow-y: auto; background: #0f172a; padding: 15px; border-radius: 10px; border: 2px solid #a855f7;">
                ${combinations.map((combo, idx) => `
                    <div class="combination-row">
                        <span class="combination-label">Sestina ${idx + 1}:</span>
                        ${combo.map(n => `<div class="ball" style="background: #a855f7;">${n}</div>`).join('')}
                    </div>
                `).join('')}
            </div>

            <div style="text-align: center; margin-top: 35px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button onclick="printSystem()" style="padding: 15px 30px; background: #10b981; color: white; border-radius: 10px; border: 2px solid #059669;">
                    üñ®Ô∏è STAMPA SUPER SISTEMA
                </button>
                <button onclick="downloadSuperSystem(${JSON.stringify(combinations)}, '${mode}')" style="padding: 15px 30px; background: #3b82f6; color: white; border-radius: 10px; border: 2px solid #2563eb;">
                    üíæ SCARICA TXT
                </button>
                <button onclick="compareWithSingleSystems()" style="padding: 15px 30px; background: #f59e0b; color: white; border-radius: 10px; border: 2px solid #d97706;">
                    üìä CONFRONTA
                </button>
                <button onclick="showSuperSystem()" style="padding: 15px 30px; background: #334155; color: #94a3b8; border-radius: 10px; border: 2px solid #475569;">
                    üîÑ NUOVO SUPER SISTEMA
                </button>
            </div>

            <div class="info-box" style="margin-top: 30px;">
                <h4>üéØ Prossimi Passi</h4>
                <p>
                    1. <strong>Scarica o stampa</strong> tutte le ${combinations.length} sestine<br>
                    2. <strong>Gioca l'intero sistema</strong> alla prossima estrazione<br>
                    3. <strong>Tieni traccia</strong> dei risultati per confronto<br>
                    4. <strong>Divertiti!</strong> Ricorda che √® un gioco, non un investimento
                </p>
            </div>
        `;

        document.getElementById('superSystemResults').innerHTML = html;
    }

    function getModeExplanation(mode, stratCount) {
        const explanations = {
            union: `Questo Super Sistema UNION combina <strong>${stratCount} diverse strategie</strong> prendendo i numeri migliori da ognuna.
                   Risultato: massima diversificazione e copertura di tutte le filosofie di gioco.`,

            intersection: `Questo Super Sistema INTERSECTION si concentra sui <strong>numeri comuni</strong> tra le ${stratCount} strategie.
                          Solo i numeri che appaiono in almeno 2 strategie vengono inclusi. Risultato: concentrazione sui "favoriti condivisi".`,

            hybrid: `Questo Super Sistema HYBRID √® un <strong>mix perfetto</strong> tra Union e Intersection.
                    Include sia i numeri comuni che alcuni numeri unici da ogni strategia. Risultato: equilibrio tra concentrazione e diversificazione.`,

            megasystem: `Questo MEGASYSTEM gioca <strong>TUTTE le sestine</strong> generate dalle ${stratCount} strategie selezionate.
                        I duplicati sono stati rimossi automaticamente. Risultato: copertura totale di tutte le combinazioni top.`
        };

        return explanations[mode] || 'Sistema ottimizzato per massima copertura.';
    }

    function downloadSuperSystem(combinations, mode) {
        let text = `SUPER SISTEMA SUPERENALOTTO - Modalit√† ${mode.toUpperCase()}\n`;
        text += '='.repeat(60) + '\n\n';
        text += `Data generazione: ${new Date().toLocaleString('it-IT')}\n`;
        text += `Totale combinazioni: ${combinations.length}\n`;
        text += `Costo totale: ${combinations.length}‚Ç¨\n`;
        text += '\n' + '='.repeat(60) + '\n\n';

        combinations.forEach((combo, idx) => {
            text += `Sestina ${String(idx + 1).padStart(3, '0')}: ${combo.join(', ')}\n`;
        });

        text += '\n' + '='.repeat(60) + '\n';
        text += 'BUONA FORTUNA! üçÄ\n';

        const blob = new Blob([text], {type: 'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `super_sistema_${mode}_${combinations.length}_sestine.txt`;
        a.click();
    }

    function compareWithSingleSystems() {
        alert('Funzione di confronto in sviluppo! Confronter√† il Super Sistema con le singole strategie.');
    }

    function selectStrategy(strategy) {
        currentStrategy = strategy;
        document.querySelectorAll('.strategy-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.closest('.strategy-btn').classList.add('active');

        if (analysisData) displayResults();
    }

    // ===============================
    // GESTIONE AGGIORNAMENTI LIVE
    // ===============================
    function addNewExtraction() {
        const input = document.getElementById('newExtraction').value.trim();
        if (!input) return alert("Inserisci i numeri dell'estrazione");

        const numbers = input.match(/\d+/g);
        if (!numbers || numbers.length < 6) {
            return alert("Formato non valido. Inserisci almeno 6 numeri");
        }

        const nums = numbers.map(Number).filter(n => n >= 1 && n <= 90);
        const uniqueNums = [...new Set(nums)].slice(0, 6);

        if (uniqueNums.length < 6) {
            return alert("Numeri insufficienti o non validi");
        }

        const currentData = document.getElementById('dataInput').value.trim();
        const newLine = uniqueNums.join(',') + (numbers[6] ? `,${numbers[6]}` : '');
        document.getElementById('dataInput').value = newLine + '\n' + currentData;

        recentExtractions.unshift({
            numbers: uniqueNums,
            timestamp: new Date().toLocaleTimeString()
        });

        recentExtractions = recentExtractions.slice(0, 5);

        document.getElementById('newExtraction').value = '';
        document.getElementById('validationInfo').innerHTML =
            `<div class="validation-info">‚úÖ Estrazione aggiunta: ${uniqueNums.join(', ')}</div>`;

        setTimeout(() => analyzeAllStrategies(), 300);
    }

    // ===============================
    // ANALISI CON PESO RECENTE
    // ===============================
    function analyzeAllStrategies() {
        const raw = document.getElementById('dataInput').value.trim();
        if (!raw) return alert("ERRORE: Nessun dato da analizzare.");

        document.getElementById('loading').style.display = 'block';
        document.getElementById('results').style.display = 'none';

        setTimeout(() => {
            try {
                analysisData = performDynamicAnalysis(raw);
                displayResults();
            } catch (error) {
                alert("Errore nell'analisi: " + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }, 100);
    }

    function performDynamicAnalysis(rawData) {
        const lines = rawData.trim().split('\n').filter(line => line.trim());
        const totalLines = lines.length;

        const recentLines = lines.slice(0, Math.min(10, totalLines));

        const stats = {
            main: Array.from({length: 91}, () => ({
                f: 0,
                d: totalLines,
                recentF: 0
            })),
            star: Array.from({length: 91}, () => ({
                f: 0,
                d: totalLines,
                recentF: 0
            })),
            totalExtractions: totalLines,
            recentExtractions: recentLines.length
        };

        lines.forEach((line, idx) => {
            const numbers = (line.match(/\d+/g) || []).map(Number);
            const isRecent = idx < recentLines.length;

            if (numbers.length >= 6) {
                numbers.slice(0, 6).forEach(n => {
                    if (n >= 1 && n <= 90) {
                        stats.main[n].f++;
                        stats.main[n].d = Math.min(stats.main[n].d, totalLines - 1 - idx);
                        if (isRecent) stats.main[n].recentF++;
                    }
                });
            }

            if (numbers.length >= 7) {
                const lastNum = numbers[numbers.length - 1];
                if (lastNum >= 1 && lastNum <= 90) {
                    stats.star[lastNum].f++;
                    stats.star[lastNum].d = Math.min(stats.star[lastNum].d, totalLines - 1 - idx);
                    if (isRecent) stats.star[lastNum].recentF++;
                }
            }
        });

        return {
            stats: stats,
            linesProcessed: totalLines,
            recentCount: recentLines.length
        };
    }

    function generateStrategyResults(stats, strategy) {
        const config = strategies[strategy];

        // STRATEGIA MATEMATICA - Distribuzione uniforme
        if (config.special === 'spread') {
            return generateSpreadStrategy(stats, config);
        }

        // STRATEGIA CONTRARIAN - Inverte la logica
        if (config.inverted) {
            return generateContrianStrategy(stats, config);
        }

        // Calcolo punteggio standard con PESO RECENTE
        let rankedMain = Object.keys(stats.main).slice(1)
            .map(Number)
            .sort((a, b) => {
                const baseScoreA = (stats.main[a].f * config.freqWeight) +
                    (stats.main[a].d * config.delayWeight);
                const recentScoreA = stats.main[a].recentF * config.recentWeight * 10;

                const baseScoreB = (stats.main[b].f * config.freqWeight) +
                    (stats.main[b].d * config.delayWeight);
                const recentScoreB = stats.main[b].recentF * config.recentWeight * 10;

                return (baseScoreB + recentScoreB) - (baseScoreA + recentScoreA);
            });

        const sestina = rankedMain.slice(0, 6).sort((a, b) => a - b);

        // Verifica se ci sono dati SuperStar validi
        const hasStarData = Object.keys(stats.star).slice(1).some(n => stats.star[n].f > 0);

        let rankedStar;
        if (hasStarData) {
            // Usa i dati SuperStar reali
            rankedStar = Object.keys(stats.star).slice(1)
                .map(Number)
                .filter(n => stats.star[n].f > 0) // Solo numeri con dati
                .sort((a, b) => {
                    const baseScoreA = (stats.star[a].f * config.freqWeight) +
                        (stats.star[a].d * config.delayWeight);
                    const recentScoreA = stats.star[a].recentF * config.recentWeight * 10;

                    const baseScoreB = (stats.star[b].f * config.freqWeight) +
                        (stats.star[b].d * config.delayWeight);
                    const recentScoreB = stats.star[b].recentF * config.recentWeight * 10;

                    return (baseScoreB + recentScoreB) - (baseScoreA + recentScoreA);
                })
                .slice(0, 3);
        } else {
            // Nessun dato SuperStar: usa i migliori numeri principali (esclusi dalla sestina)
            rankedStar = rankedMain
                .filter(n => !sestina.includes(n))
                .slice(0, 3);
        }

        return {
            sestina: sestina,
            stars: rankedStar,
            delays: Object.keys(stats.main).slice(1)
                .map(Number)
                .sort((a, b) => stats.main[b].d - stats.main[a].d)
                .slice(0, 5)
        };
    }

    // Strategia distribuzione uniforme
    function generateSpreadStrategy(stats, config) {
        // Divide il range 1-90 in 6 zone
        const zones = [
            [1, 15],   // Zona 1
            [16, 30],  // Zona 2
            [31, 45],  // Zona 3
            [46, 60],  // Zona 4
            [61, 75],  // Zona 5
            [76, 90]   // Zona 6
        ];

        const sestina = [];
        zones.forEach(([min, max]) => {
            // Prendi il miglior numero di ogni zona
            const zoneNumbers = Object.keys(stats.main).slice(min, max + 1)
                .map(Number)
                .sort((a, b) => {
                    const scoreA = (stats.main[a].f * config.freqWeight) +
                        (stats.main[a].d * config.delayWeight);
                    const scoreB = (stats.main[b].f * config.freqWeight) +
                        (stats.main[b].d * config.delayWeight);
                    return scoreB - scoreA;
                });
            if (zoneNumbers[0]) sestina.push(zoneNumbers[0]);
        });

        // Verifica se ci sono dati SuperStar validi
        const hasStarData = Object.keys(stats.star).slice(1).some(n => stats.star[n].f > 0);

        let rankedStar;
        if (hasStarData) {
            rankedStar = Object.keys(stats.star).slice(1)
                .map(Number)
                .filter(n => stats.star[n].f > 0)
                .sort((a, b) => stats.star[b].f - stats.star[a].f)
                .slice(0, 3);
        } else {
            // Fallback: numeri centrali di ogni zona non nella sestina
            const allZoneNumbers = [];
            zones.forEach(([min, max]) => {
                const mid = Math.floor((min + max) / 2);
                if (!sestina.includes(mid)) allZoneNumbers.push(mid);
            });
            rankedStar = allZoneNumbers.slice(0, 3);
        }

        return {
            sestina: sestina.sort((a, b) => a - b),
            stars: rankedStar,
            delays: []
        };
    }

    // Strategia contrarian - evita i pi√π popolari
    function generateContrianStrategy(stats, config) {
        let rankedMain = Object.keys(stats.main).slice(1)
            .map(Number)
            .sort((a, b) => {
                // Penalizza i frequenti, premia i ritardatari
                const scoreA = (-stats.main[a].f * 0.3) + (stats.main[a].d * 0.7);
                const scoreB = (-stats.main[b].f * 0.3) + (stats.main[b].d * 0.7);
                return scoreB - scoreA;
            });

        // Evita anche i numeri "ovvi" come multipli di 5 e numeri sotto 31
        rankedMain = rankedMain.filter(n => {
            const isMultipleOf5 = n % 5 === 0;
            const isDateNumber = n <= 31;
            const isVeryFrequent = stats.main[n].f > stats.totalExtractions * 0.015;
            return !(isMultipleOf5 || (isDateNumber && isVeryFrequent));
        });

        const sestina = rankedMain.slice(0, 6).sort((a, b) => a - b);

        // Verifica se ci sono dati SuperStar validi
        const hasStarData = Object.keys(stats.star).slice(1).some(n => stats.star[n].f > 0);

        let rankedStar;
        if (hasStarData) {
            rankedStar = Object.keys(stats.star).slice(1)
                .map(Number)
                .filter(n => stats.star[n].f > 0 && stats.star[n].f < stats.totalExtractions * 0.015)
                .sort((a, b) => stats.star[b].d - stats.star[a].d)
                .slice(0, 3);

            // Se il filtro √® troppo restrittivo, prendi comunque i meno frequenti
            if (rankedStar.length < 3) {
                rankedStar = Object.keys(stats.star).slice(1)
                    .map(Number)
                    .filter(n => stats.star[n].f > 0)
                    .sort((a, b) => stats.star[a].f - stats.star[b].f) // Meno frequenti
                    .slice(0, 3);
            }
        } else {
            // Fallback: numeri "contrarian" non nella sestina (alti e non multipli di 5)
            rankedStar = rankedMain
                .filter(n => !sestina.includes(n) && n > 45 && n % 5 !== 0)
                .slice(0, 3);

            if (rankedStar.length < 3) {
                rankedStar = [47, 68, 83]; // Fallback fisso contrarian
            }
        }

        return {
            sestina: sestina,
            stars: rankedStar,
            delays: []
        };
    }

    function displayResults() {
        if (!analysisData) return;

        document.getElementById('results').style.display = 'block';

        let updateInfo = '';
        if (previousResults) {
            const changes = compareResults(previousResults, analysisData);
            updateInfo = `<div class="validation-info">${changes}</div>`;
        }
        document.getElementById('updateInfo').innerHTML = updateInfo;

        let resultsHTML = '';

        Object.keys(strategies).forEach(strategyKey => {
            const strategy = strategies[strategyKey];
            const result = generateStrategyResults(analysisData.stats, strategyKey);
            const isUpdated = checkForUpdates(strategyKey, result);

            resultsHTML += `
                <div class="strategy-section ${isUpdated ? 'updated' : ''}" style="border-left: 4px solid ${strategy.color}">
                    <div class="strategy-header">
                        <div>
                            <div class="strategy-title">${strategy.name} ${isUpdated ? 'üîÑ' : ''}</div>
                            <div class="strategy-desc">
                                Estraz. recenti: ${analysisData.recentCount}/${analysisData.linesProcessed}
                                (Peso: ${Math.round(strategy.recentWeight * 100)}%)
                            </div>
                        </div>
                    </div>

                    <div class="label">Sestina Suggerita</div>
                    <div class="balls">
                        ${result.sestina.map((n, index) => {
                const isNew = isUpdated && index < 2;
                return `<div class="ball ${isNew ? 'new' : ''}" style="background: ${strategy.color}">
                                ${n}
                                ${isNew ? '<div class="recency-badge">N</div>' : ''}
                            </div>`;
            }).join('')}
                    </div>

                    <div class="label">SuperStar Consigliati</div>
                    <div class="balls">
                        ${result.stars.map((n, i) =>
                `<div class="ball star" style="animation-delay: ${i * 0.3}s">${n}</div>`
            ).join('')}
                    </div>

                    <div class="comparison">
                        <strong>Analisi Estrazioni Recenti:</strong><br>
                        ‚Ä¢ Numeri nelle ultime estrazioni: ${getRecentNumbersInfo(result.sestina)}<br>
                        ‚Ä¢ SuperStar recenti: ${getRecentNumbersInfo(result.stars)}
                    </div>
                </div>
            `;
        });

        document.getElementById('strategyResults').innerHTML = resultsHTML;

        previousResults = {...analysisData};

        document.getElementById('log').innerHTML =
            `> ESTRAZIONI TOTALI: ${analysisData.linesProcessed}<br>` +
            `> ESTRAZIONI RECENTI: ${analysisData.recentCount}<br>` +
            `> ULTIME AGGIUNTE: ${recentExtractions.length}`;
    }

    function compareResults(oldData, newData) {
        if (!oldData) return "üÜï Analisi iniziale completata";

        const changes = [];
        if (newData.linesProcessed > oldData.linesProcessed) {
            changes.push(`+${newData.linesProcessed - oldData.linesProcessed} nuove estrazioni`);
        }
        if (newData.recentCount > oldData.recentCount) {
            changes.push(`+${newData.recentCount - oldData.recentCount} estrazioni recenti`);
        }

        return changes.length > 0 ?
            `üîÑ Aggiornamento: ${changes.join(', ')}` :
            "üìä Dati invariati - stessi risultati";
    }

    function checkForUpdates(strategyKey, newResult) {
        return recentExtractions.length > 0 || !previousResults;
    }

    function getRecentNumbersInfo(numbers) {
        const recentNumbers = recentExtractions.flatMap(ext => ext.numbers);
        const matches = numbers.filter(n => recentNumbers.includes(n));
        return matches.length > 0 ? matches.join(', ') : 'nessuno';
    }

    function clearData() {
        document.getElementById('dataInput').value = '';
        document.getElementById('newExtraction').value = '';
        document.getElementById('results').style.display = 'none';
        document.getElementById('validationInfo').innerHTML = '';
        document.getElementById('strategyResults').innerHTML = '';
        document.getElementById('updateInfo').innerHTML = '';
        analysisData = null;
        previousResults = null;
        recentExtractions = [];
        localStorage.removeItem('lastArchive');
        // Nascondi pannello ultima estrazione
        document.getElementById('lastExtractionPanel').style.display = 'none';
    }

    // ===============================
    // MOSTRA ULTIMA ESTRAZIONE
    // ===============================
    function displayLastExtraction(data) {
        const lines = data.trim().split('\n').filter(line => line.trim());
        if (lines.length === 0) {
            document.getElementById('lastExtractionPanel').style.display = 'none';
            return;
        }

        // Prendi la prima riga (ultima estrazione - assumendo ordine cronologico inverso)
        const lastLine = lines[0];
        const numbers = (lastLine.match(/\d+/g) || []).map(Number);

        if (numbers.length < 6) {
            document.getElementById('lastExtractionPanel').style.display = 'none';
            return;
        }

        const mainNumbers = numbers.slice(0, 6);
        const superStar = numbers.length >= 7 ? numbers[6] : null;

        // Genera HTML per le palline principali
        const ballsHTML = mainNumbers.map((n, i) => {
            // Colori diversi per variet√† visiva
            const colors = [
                'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4) 0%, #3b82f6 25%, #1d4ed8 70%, #1e3a8a 100%)',
                'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4) 0%, #8b5cf6 25%, #7c3aed 70%, #5b21b6 100%)',
                'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4) 0%, #ec4899 25%, #db2777 70%, #9d174d 100%)',
                'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4) 0%, #10b981 25%, #059669 70%, #047857 100%)',
                'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4) 0%, #f59e0b 25%, #d97706 70%, #b45309 100%)',
                'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4) 0%, #ef4444 25%, #dc2626 70%, #b91c1c 100%)'
            ];
            return `<div class="ball" style="background: ${colors[i]};">${n}</div>`;
        }).join('');

        // Genera HTML per il SuperStar
        let starHTML;
        if (superStar !== null) {
            starHTML = `<div class="ball star">${superStar}</div>`;
        } else {
            starHTML = `<div class="no-star">N/D</div>`;
        }

        // Aggiorna il DOM
        document.getElementById('lastExtractionBalls').innerHTML = ballsHTML;
        document.getElementById('lastExtractionStar').innerHTML = starHTML;
        document.getElementById('lastExtractionDate').textContent = `Estrazione #${lines.length}`;
        document.getElementById('lastExtractionPanel').style.display = 'block';
    }

    const fileInput = document.getElementById('fileInput');
    fileInput.addEventListener('change', handleFileUpload);

    function handleFileUpload(e) {
        const file = e.target.files[0];
        const reader = new FileReader();

        reader.onload = function(ev) {
            const validation = validateData(ev.target.result);

            if (validation.valid) {
                document.getElementById('dataInput').value = validation.data;
                const ssInfo = validation.validLinesWithSS > 0
                    ? ` (${validation.validLinesWithSS} con SuperStar)`
                    : ' (‚ö†Ô∏è Nessun SuperStar trovato)';
                document.getElementById('validationInfo').innerHTML =
                    `<div class="validation-info">‚úì File caricato: ${validation.validLines} righe valide${ssInfo}</div>`;

                localStorage.setItem('lastArchive', validation.data);
                recentExtractions = [];

                // Mostra ultima estrazione
                displayLastExtraction(validation.data);
            } else {
                document.getElementById('validationInfo').innerHTML =
                    `<div class="validation-error">‚úó Errore: ${validation.error}</div>`;
            }
        };

        reader.readAsText(file);
    }

    function validateData(rawData) {
        const lines = rawData.trim().split('\n');
        let validLines = 0;
        let validLinesWithSS = 0;
        let processedData = '';

        for (let line of lines) {
            const cleanLine = line.trim();
            if (!cleanLine) continue;

            let mainNumbers = [];
            let superStar = null;

            // Verifica se il formato contiene "| SS:" o "|SS:"
            if (cleanLine.includes('|') && cleanLine.toLowerCase().includes('ss')) {
                // Formato: "1,2,3,4,5,6 | SS:7" o "1,2,3,4,5,6|SS: 7"
                const parts = cleanLine.split('|');

                // Estrai i 6 numeri principali dalla prima parte
                const mainMatch = parts[0].match(/\d+/g);
                if (mainMatch) {
                    mainNumbers = mainMatch.map(Number).filter(n => n >= 1 && n <= 90);
                }

                // Estrai il SuperStar dalla seconda parte
                if (parts[1]) {
                    const ssMatch = parts[1].match(/\d+/);
                    if (ssMatch) {
                        const ss = parseInt(ssMatch[0]);
                        if (ss >= 1 && ss <= 90) {
                            superStar = ss;
                        }
                    }
                }
            } else {
                // Formato semplice: "1,2,3,4,5,6" o "1,2,3,4,5,6,7"
                const numbers = cleanLine.match(/\d+/g);
                if (numbers) {
                    const nums = numbers.map(Number).filter(n => n >= 1 && n <= 90);
                    mainNumbers = nums.slice(0, 6);
                    if (nums.length >= 7) {
                        superStar = nums[6];
                    }
                }
            }

            // Rimuovi duplicati dai numeri principali
            const uniqueNums = [];
            const seen = new Set();
            for (const num of mainNumbers) {
                if (!seen.has(num)) {
                    seen.add(num);
                    uniqueNums.push(num);
                }
                if (uniqueNums.length >= 6) break;
            }

            // Valida e salva
            if (uniqueNums.length === 6) {
                if (superStar !== null) {
                    processedData += uniqueNums.join(',') + ',' + superStar + '\n';
                    validLinesWithSS++;
                } else {
                    processedData += uniqueNums.join(',') + '\n';
                }
                validLines++;
            }
        }

        return {
            valid: validLines > 0,
            data: processedData,
            validLines: validLines,
            validLinesWithSS: validLinesWithSS,
            error: validLines === 0 ? 'Nessuna riga valida trovata' : null
        };
    }

    document.addEventListener('DOMContentLoaded', function() {
        const lastArchive = localStorage.getItem('lastArchive');
        if (lastArchive) {
            document.getElementById('dataInput').value = lastArchive;
            document.getElementById('validationInfo').innerHTML =
                '<div class="validation-info">‚úì Archivio precedente caricato</div>';
        }
    });
</script>
</body>
</html>